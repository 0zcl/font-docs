<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>需求场景 | 亮神前端小册</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="亮神前端小册">
    
    <link rel="preload" href="/font-docs/assets/css/0.styles.f8f07172.css" as="style"><link rel="preload" href="/font-docs/assets/js/app.ab113d22.js" as="script"><link rel="preload" href="/font-docs/assets/js/2.a7702232.js" as="script"><link rel="preload" href="/font-docs/assets/js/5.3099e729.js" as="script"><link rel="prefetch" href="/font-docs/assets/js/10.3d24c721.js"><link rel="prefetch" href="/font-docs/assets/js/100.b317c338.js"><link rel="prefetch" href="/font-docs/assets/js/101.b20aa33e.js"><link rel="prefetch" href="/font-docs/assets/js/102.b1f8d3b3.js"><link rel="prefetch" href="/font-docs/assets/js/103.ecb92d20.js"><link rel="prefetch" href="/font-docs/assets/js/104.59d1da3b.js"><link rel="prefetch" href="/font-docs/assets/js/105.b6bb704c.js"><link rel="prefetch" href="/font-docs/assets/js/106.32bea12f.js"><link rel="prefetch" href="/font-docs/assets/js/107.2a3c779a.js"><link rel="prefetch" href="/font-docs/assets/js/108.a28ed267.js"><link rel="prefetch" href="/font-docs/assets/js/109.e83bff13.js"><link rel="prefetch" href="/font-docs/assets/js/11.5bc93b46.js"><link rel="prefetch" href="/font-docs/assets/js/110.7fc996c2.js"><link rel="prefetch" href="/font-docs/assets/js/111.de0109d7.js"><link rel="prefetch" href="/font-docs/assets/js/112.85b9449c.js"><link rel="prefetch" href="/font-docs/assets/js/113.fc975125.js"><link rel="prefetch" href="/font-docs/assets/js/114.216bea7c.js"><link rel="prefetch" href="/font-docs/assets/js/115.090cfb62.js"><link rel="prefetch" href="/font-docs/assets/js/116.afa4d357.js"><link rel="prefetch" href="/font-docs/assets/js/117.914c90da.js"><link rel="prefetch" href="/font-docs/assets/js/118.36abb410.js"><link rel="prefetch" href="/font-docs/assets/js/119.d885fe45.js"><link rel="prefetch" href="/font-docs/assets/js/12.961a36e2.js"><link rel="prefetch" href="/font-docs/assets/js/120.54ed503a.js"><link rel="prefetch" href="/font-docs/assets/js/121.c3ea5174.js"><link rel="prefetch" href="/font-docs/assets/js/122.a623dd2a.js"><link rel="prefetch" href="/font-docs/assets/js/13.4c670e5e.js"><link rel="prefetch" href="/font-docs/assets/js/14.a1ce3775.js"><link rel="prefetch" href="/font-docs/assets/js/15.fa5a860a.js"><link rel="prefetch" href="/font-docs/assets/js/16.edacc258.js"><link rel="prefetch" href="/font-docs/assets/js/17.f8df7a8b.js"><link rel="prefetch" href="/font-docs/assets/js/18.72dcdd23.js"><link rel="prefetch" href="/font-docs/assets/js/19.706d6807.js"><link rel="prefetch" href="/font-docs/assets/js/20.108ddf67.js"><link rel="prefetch" href="/font-docs/assets/js/21.7da88a2a.js"><link rel="prefetch" href="/font-docs/assets/js/22.70a646e4.js"><link rel="prefetch" href="/font-docs/assets/js/23.c1c80ab4.js"><link rel="prefetch" href="/font-docs/assets/js/24.8be1409c.js"><link rel="prefetch" href="/font-docs/assets/js/25.dafa3760.js"><link rel="prefetch" href="/font-docs/assets/js/26.694e01e9.js"><link rel="prefetch" href="/font-docs/assets/js/27.039090e0.js"><link rel="prefetch" href="/font-docs/assets/js/28.0c94be50.js"><link rel="prefetch" href="/font-docs/assets/js/29.c32e555d.js"><link rel="prefetch" href="/font-docs/assets/js/3.c0d26cb5.js"><link rel="prefetch" href="/font-docs/assets/js/30.c9f6fdd6.js"><link rel="prefetch" href="/font-docs/assets/js/31.bcbaf1a9.js"><link rel="prefetch" href="/font-docs/assets/js/32.36213dc7.js"><link rel="prefetch" href="/font-docs/assets/js/33.f7c8afde.js"><link rel="prefetch" href="/font-docs/assets/js/34.e834e023.js"><link rel="prefetch" href="/font-docs/assets/js/35.8dda312f.js"><link rel="prefetch" href="/font-docs/assets/js/36.11df78b4.js"><link rel="prefetch" href="/font-docs/assets/js/37.15a9a489.js"><link rel="prefetch" href="/font-docs/assets/js/38.cec81ca8.js"><link rel="prefetch" href="/font-docs/assets/js/39.8ddef536.js"><link rel="prefetch" href="/font-docs/assets/js/4.ea27e4cd.js"><link rel="prefetch" href="/font-docs/assets/js/40.193534f1.js"><link rel="prefetch" href="/font-docs/assets/js/41.ce1b23e7.js"><link rel="prefetch" href="/font-docs/assets/js/42.11994eef.js"><link rel="prefetch" href="/font-docs/assets/js/43.1120971d.js"><link rel="prefetch" href="/font-docs/assets/js/44.e70be40e.js"><link rel="prefetch" href="/font-docs/assets/js/45.f32091eb.js"><link rel="prefetch" href="/font-docs/assets/js/46.0470b16d.js"><link rel="prefetch" href="/font-docs/assets/js/47.f8af876b.js"><link rel="prefetch" href="/font-docs/assets/js/48.ce448fc0.js"><link rel="prefetch" href="/font-docs/assets/js/49.3c9aa3b6.js"><link rel="prefetch" href="/font-docs/assets/js/50.0247cc44.js"><link rel="prefetch" href="/font-docs/assets/js/51.edaf96f4.js"><link rel="prefetch" href="/font-docs/assets/js/52.bac5c38d.js"><link rel="prefetch" href="/font-docs/assets/js/53.9a769cc8.js"><link rel="prefetch" href="/font-docs/assets/js/54.755585b1.js"><link rel="prefetch" href="/font-docs/assets/js/55.0c0d8035.js"><link rel="prefetch" href="/font-docs/assets/js/56.906e3715.js"><link rel="prefetch" href="/font-docs/assets/js/57.6d39b791.js"><link rel="prefetch" href="/font-docs/assets/js/58.e39d5548.js"><link rel="prefetch" href="/font-docs/assets/js/59.9a4436d4.js"><link rel="prefetch" href="/font-docs/assets/js/6.fa3b5319.js"><link rel="prefetch" href="/font-docs/assets/js/60.db97d3d4.js"><link rel="prefetch" href="/font-docs/assets/js/61.63ebb788.js"><link rel="prefetch" href="/font-docs/assets/js/62.2e1642b4.js"><link rel="prefetch" href="/font-docs/assets/js/63.404afa47.js"><link rel="prefetch" href="/font-docs/assets/js/64.3fc9bd1a.js"><link rel="prefetch" href="/font-docs/assets/js/65.087359aa.js"><link rel="prefetch" href="/font-docs/assets/js/66.0e1dbfa1.js"><link rel="prefetch" href="/font-docs/assets/js/67.f5508703.js"><link rel="prefetch" href="/font-docs/assets/js/68.063a4309.js"><link rel="prefetch" href="/font-docs/assets/js/69.e003c953.js"><link rel="prefetch" href="/font-docs/assets/js/7.8f66f4e3.js"><link rel="prefetch" href="/font-docs/assets/js/70.db533f79.js"><link rel="prefetch" href="/font-docs/assets/js/71.f5adc2fe.js"><link rel="prefetch" href="/font-docs/assets/js/72.c77d8ceb.js"><link rel="prefetch" href="/font-docs/assets/js/73.53bb4c8a.js"><link rel="prefetch" href="/font-docs/assets/js/74.fa982014.js"><link rel="prefetch" href="/font-docs/assets/js/75.ebc912b8.js"><link rel="prefetch" href="/font-docs/assets/js/76.360b896f.js"><link rel="prefetch" href="/font-docs/assets/js/77.09e34fb3.js"><link rel="prefetch" href="/font-docs/assets/js/78.e51a0adc.js"><link rel="prefetch" href="/font-docs/assets/js/79.0d18c5fd.js"><link rel="prefetch" href="/font-docs/assets/js/8.91fc3f7b.js"><link rel="prefetch" href="/font-docs/assets/js/80.19046804.js"><link rel="prefetch" href="/font-docs/assets/js/81.86b61c9b.js"><link rel="prefetch" href="/font-docs/assets/js/82.e3b85ba1.js"><link rel="prefetch" href="/font-docs/assets/js/83.2e228169.js"><link rel="prefetch" href="/font-docs/assets/js/84.3c6de565.js"><link rel="prefetch" href="/font-docs/assets/js/85.195aa246.js"><link rel="prefetch" href="/font-docs/assets/js/86.9592c42a.js"><link rel="prefetch" href="/font-docs/assets/js/87.4f35105c.js"><link rel="prefetch" href="/font-docs/assets/js/88.3eb20e04.js"><link rel="prefetch" href="/font-docs/assets/js/89.aa1241cf.js"><link rel="prefetch" href="/font-docs/assets/js/9.c2c6aed5.js"><link rel="prefetch" href="/font-docs/assets/js/90.097b16ac.js"><link rel="prefetch" href="/font-docs/assets/js/91.bcc1349e.js"><link rel="prefetch" href="/font-docs/assets/js/92.3b8c2727.js"><link rel="prefetch" href="/font-docs/assets/js/93.2ef6a5d8.js"><link rel="prefetch" href="/font-docs/assets/js/94.5d8072d4.js"><link rel="prefetch" href="/font-docs/assets/js/95.7e6d60ea.js"><link rel="prefetch" href="/font-docs/assets/js/96.2f7249dc.js"><link rel="prefetch" href="/font-docs/assets/js/97.bc860a09.js"><link rel="prefetch" href="/font-docs/assets/js/98.c48a9f29.js"><link rel="prefetch" href="/font-docs/assets/js/99.7f628413.js">
    <link rel="stylesheet" href="/font-docs/assets/css/0.styles.f8f07172.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/font-docs/" class="home-link router-link-active"><!----> <span class="site-name">亮神前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/font-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/font-docs/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/font-docs/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/font-docs/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/font-docs/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/font-docs/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/font-docs/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/font-docs/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/font-docs/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/font-docs/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/font-docs/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/font-docs/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/0zcl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/font-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/font-docs/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/font-docs/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/font-docs/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/font-docs/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/font-docs/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/font-docs/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/font-docs/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/font-docs/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/font-docs/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/font-docs/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/font-docs/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/0zcl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>B端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>移动端H5</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/font-docs/project/H5/common-login-h5.html" class="sidebar-link">统一登陆</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/project/H5/common-login-h5.html#需求背景" class="sidebar-link">需求背景</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/common-login-h5.html#业务-了解" class="sidebar-link">业务(了解)</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/common-login-h5.html#统一登陆相关h5" class="sidebar-link">统一登陆相关H5</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/common-login-h5.html#微信授权登陆" class="sidebar-link">微信授权登陆</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/common-login-h5.html#统一登陆banner" class="sidebar-link">统一登陆Banner</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/common-login-h5.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/font-docs/project/H5/h5-sdk.html" aria-current="page" class="active sidebar-link">h5-sdk</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#需求场景" class="sidebar-link">需求场景</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#拓展性实现" class="sidebar-link">拓展性实现</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#一、appsdk" class="sidebar-link">一、appSdk</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#二、wxsdk" class="sidebar-link">二、wxSdk</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#三、loginsdk" class="sidebar-link">三、loginSdk</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#登陆banner" class="sidebar-link">登陆Banner</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#loginsdk难点" class="sidebar-link">loginSdk难点</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#打包优化" class="sidebar-link">打包优化</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#打包难点" class="sidebar-link">打包难点</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#部署" class="sidebar-link">部署</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#nginx配置" class="sidebar-link">nginx配置</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-sdk.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/font-docs/project/H5/h5-template.html" class="sidebar-link">vue移动端多页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-template.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/h5-template.html#代码" class="sidebar-link">代码</a></li></ul></li><li><a href="/font-docs/project/H5/mobile-ui.html" class="sidebar-link">移动端UI组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/project/H5/mobile-ui.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/mobile-ui.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/mobile-ui.html#难点" class="sidebar-link">难点</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/mobile-ui.html#vant-cli源码简析" class="sidebar-link">vant-cli源码简析</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/mobile-ui.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/font-docs/project/H5/pay-center.html" class="sidebar-link">支付中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/project/H5/pay-center.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/pay-center.html#业务" class="sidebar-link">业务</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/pay-center.html#难点" class="sidebar-link">难点</a></li><li class="sidebar-sub-header"><a href="/font-docs/project/H5/pay-center.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default" data-v-825a5a7e data-v-825a5a7e><h2 id="需求场景" data-v-825a5a7e><a href="#需求场景" class="header-anchor" data-v-825a5a7e>#</a> 需求场景</h2> <p data-v-825a5a7e>起初，前端团队开发的H5是可接入直播团队APP的webView中，就需要调用到IOS/Android提供的接口，如关闭页面，调起微信等。</p> <p data-v-825a5a7e>每次开发H5时，都需要和app的开发者对接，导致重复开发，重复沟通，效率低下。因此开发了初版app-sdk来封装APP端提供的接口。</p> <p data-v-825a5a7e>后面由于业务的拓展，加入了统一登陆的SDK和微信相关SDK。H5SDK项目目前封装了<code data-v-825a5a7e>app的SDK</code>，<code data-v-825a5a7e>统一登陆SDK</code>，<code data-v-825a5a7e>微信相关SDK</code>（目前有<code data-v-825a5a7e>微信分享</code>和<code data-v-825a5a7e>微信主动授权</code>）。H5SDK是可拓展的，<strong data-v-825a5a7e>目标是封装移动端的各种SDK</strong></p> <h2 id="拓展性实现" data-v-825a5a7e><a href="#拓展性实现" class="header-anchor" data-v-825a5a7e>#</a> 拓展性实现</h2> <p data-v-825a5a7e><img src="data:image/png;base64,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" alt="sdk" data-v-825a5a7e></p> <p data-v-825a5a7e>appSdk, loginSdk, wxSdk分别是目前封装的sdk，index.ts是打包的入口文件。在index.ts，抛出了一个<code data-v-825a5a7e>包含三个sdk构造函数的对象</code></p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>import</span> <span class="token constant" data-v-825a5a7e>H5SDK</span> <span class="token keyword" data-v-825a5a7e>from</span> <span class="token string" data-v-825a5a7e>'../../dist/H5SDK'</span>
<span class="token keyword" data-v-825a5a7e>const</span> <span class="token punctuation" data-v-825a5a7e>{</span> AppSDK<span class="token punctuation" data-v-825a5a7e>,</span> WxSDK<span class="token punctuation" data-v-825a5a7e>,</span> LoginSDK <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token constant" data-v-825a5a7e>H5SDK</span>
<span class="token comment" data-v-825a5a7e>// Vue的话，可以挂载到Vue构造函数的原型中</span>
<span class="token class-name" data-v-825a5a7e>Vue</span><span class="token punctuation" data-v-825a5a7e>.</span>prototype<span class="token punctuation" data-v-825a5a7e>.</span>appSDK <span class="token operator" data-v-825a5a7e>=</span> <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>AppSDK</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token class-name" data-v-825a5a7e>Vue</span><span class="token punctuation" data-v-825a5a7e>.</span>prototype<span class="token punctuation" data-v-825a5a7e>.</span>wxSDK <span class="token operator" data-v-825a5a7e>=</span> <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>WxSDK</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token class-name" data-v-825a5a7e>Vue</span><span class="token punctuation" data-v-825a5a7e>.</span>prototype<span class="token punctuation" data-v-825a5a7e>.</span>LoginSDK <span class="token operator" data-v-825a5a7e>=</span> <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>LoginSDK</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>每个sdk构造函数实例对象时(通过new来实例)，会执行init把sdk封装好的函数挂载到sdk构造函数的原型上</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>const</span> <span class="token function-variable function" data-v-825a5a7e>init</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  Object<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>keys</span><span class="token punctuation" data-v-825a5a7e>(</span>sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>methods<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>forEach</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>method<span class="token operator" data-v-825a5a7e>:</span> string</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>constructor<span class="token punctuation" data-v-825a5a7e>.</span>prototype<span class="token punctuation" data-v-825a5a7e>[</span>method<span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e><span class="token operator" data-v-825a5a7e>...</span>args<span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'method'</span><span class="token punctuation" data-v-825a5a7e>,</span> method<span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token keyword" data-v-825a5a7e>return</span> sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>methods<span class="token punctuation" data-v-825a5a7e>[</span>method<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>apply</span><span class="token punctuation" data-v-825a5a7e>(</span>sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>constructor<span class="token punctuation" data-v-825a5a7e>,</span> args<span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>代码参考。后面可修改sdkList对象，来拓展sdk</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>import</span> <span class="token operator" data-v-825a5a7e>*</span> <span class="token keyword" data-v-825a5a7e>as</span> appSdk_methods <span class="token keyword" data-v-825a5a7e>from</span> <span class="token string" data-v-825a5a7e>'./appSdk/methods'</span>
<span class="token keyword" data-v-825a5a7e>import</span> <span class="token operator" data-v-825a5a7e>*</span> <span class="token keyword" data-v-825a5a7e>as</span> wxSdk_methods <span class="token keyword" data-v-825a5a7e>from</span> <span class="token string" data-v-825a5a7e>'./wxSdk/methods'</span>
<span class="token keyword" data-v-825a5a7e>import</span> <span class="token operator" data-v-825a5a7e>*</span> <span class="token keyword" data-v-825a5a7e>as</span> loginSdk_methods <span class="token keyword" data-v-825a5a7e>from</span> <span class="token string" data-v-825a5a7e>'./loginSdk/methods'</span>

<span class="token keyword" data-v-825a5a7e>const</span> sdkList<span class="token operator" data-v-825a5a7e>:</span> SdkList <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>[</span>
  <span class="token punctuation" data-v-825a5a7e>{</span>
    constructor<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'AppSDK'</span><span class="token punctuation" data-v-825a5a7e>,</span>
    methods<span class="token operator" data-v-825a5a7e>:</span> appSdk_methods
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token punctuation" data-v-825a5a7e>{</span>
    constructor<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'WxSDK'</span><span class="token punctuation" data-v-825a5a7e>,</span>
    methods<span class="token operator" data-v-825a5a7e>:</span> wxSdk_methods
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token punctuation" data-v-825a5a7e>{</span>
    constructor<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'LoginSDK'</span><span class="token punctuation" data-v-825a5a7e>,</span>
    methods<span class="token operator" data-v-825a5a7e>:</span> loginSdk_methods
  <span class="token punctuation" data-v-825a5a7e>}</span>
<span class="token punctuation" data-v-825a5a7e>]</span>
<span class="token keyword" data-v-825a5a7e>const</span> <span class="token constant" data-v-825a5a7e>H5SDK</span><span class="token operator" data-v-825a5a7e>:</span> Obj <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>{</span><span class="token punctuation" data-v-825a5a7e>}</span>

<span class="token keyword" data-v-825a5a7e>for</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token keyword" data-v-825a5a7e>let</span> i<span class="token operator" data-v-825a5a7e>=</span><span class="token number" data-v-825a5a7e>0</span><span class="token punctuation" data-v-825a5a7e>,</span> len<span class="token operator" data-v-825a5a7e>=</span>sdkList<span class="token punctuation" data-v-825a5a7e>.</span>length<span class="token punctuation" data-v-825a5a7e>;</span> i<span class="token operator" data-v-825a5a7e>&lt;</span>len<span class="token punctuation" data-v-825a5a7e>;</span> i<span class="token operator" data-v-825a5a7e>++</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token keyword" data-v-825a5a7e>const</span> sdkItem <span class="token operator" data-v-825a5a7e>=</span> sdkList<span class="token punctuation" data-v-825a5a7e>[</span>i<span class="token punctuation" data-v-825a5a7e>]</span>
  <span class="token keyword" data-v-825a5a7e>const</span> constructorName <span class="token operator" data-v-825a5a7e>=</span> sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>constructor
  <span class="token keyword" data-v-825a5a7e>const</span> <span class="token function-variable function" data-v-825a5a7e>init</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    Object<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>keys</span><span class="token punctuation" data-v-825a5a7e>(</span>sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>methods<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>forEach</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>method<span class="token operator" data-v-825a5a7e>:</span> string</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>constructor<span class="token punctuation" data-v-825a5a7e>.</span>prototype<span class="token punctuation" data-v-825a5a7e>[</span>method<span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e><span class="token operator" data-v-825a5a7e>...</span>args<span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'method'</span><span class="token punctuation" data-v-825a5a7e>,</span> method<span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token keyword" data-v-825a5a7e>return</span> sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>methods<span class="token punctuation" data-v-825a5a7e>[</span>method<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>apply</span><span class="token punctuation" data-v-825a5a7e>(</span>sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>constructor<span class="token punctuation" data-v-825a5a7e>,</span> args<span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token punctuation" data-v-825a5a7e>}</span>
    <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token comment" data-v-825a5a7e>// sdk构造函数</span>
  sdkItem<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function-variable function" data-v-825a5a7e>constructor</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token keyword" data-v-825a5a7e>function</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>this</span><span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token operator" data-v-825a5a7e>!</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token keyword" data-v-825a5a7e>this</span> <span class="token keyword" data-v-825a5a7e>instanceof</span> <span class="token class-name" data-v-825a5a7e>sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>constructor</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token function" data-v-825a5a7e>warn</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>constructorName<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e> is a constructor and should be called with the 'new' keyword</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
    <span class="token comment" data-v-825a5a7e>// 挂载函数</span>
    <span class="token function" data-v-825a5a7e>init</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token constant" data-v-825a5a7e>H5SDK</span><span class="token punctuation" data-v-825a5a7e>[</span>constructorName<span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>=</span> sdkItem<span class="token punctuation" data-v-825a5a7e>.</span>constructor
<span class="token punctuation" data-v-825a5a7e>}</span>

<span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>default</span> <span class="token constant" data-v-825a5a7e>H5SDK</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>21</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>22</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>23</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>24</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>25</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>26</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>27</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>28</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>29</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>30</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>31</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>32</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>33</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>34</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>35</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>36</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>37</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>38</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>39</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>40</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>41</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>42</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>43</span><br data-v-825a5a7e></div></div><h2 id="一、appsdk" data-v-825a5a7e><a href="#一、appsdk" class="header-anchor" data-v-825a5a7e>#</a> 一、appSdk</h2> <h3 id="移动端-h5与安卓-ios之间通信" data-v-825a5a7e><a href="#移动端-h5与安卓-ios之间通信" class="header-anchor" data-v-825a5a7e>#</a> 移动端：H5与安卓/ios之间通信</h3> <p data-v-825a5a7e>app里面嵌套H5页面， 安卓和ios提供一个空壳子，方法两者互相调用。</p> <ol data-v-825a5a7e><li data-v-825a5a7e>安卓和ios不同。需要写一个方法，来判断机型是安卓或者是ios</li> <li data-v-825a5a7e>H5执行IOS的接口: <code data-v-825a5a7e>webkit.messageHandlers[action].postMessage({})</code></li> <li data-v-825a5a7e>H5执行Android的接口: <code data-v-825a5a7e>window.android[action]()</code>。</li></ol> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>actionFun</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e><span class="token operator" data-v-825a5a7e>...</span>arg<span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token keyword" data-v-825a5a7e>void</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token keyword" data-v-825a5a7e>const</span> action <span class="token operator" data-v-825a5a7e>=</span> arg<span class="token punctuation" data-v-825a5a7e>[</span><span class="token number" data-v-825a5a7e>0</span><span class="token punctuation" data-v-825a5a7e>]</span>
  <span class="token keyword" data-v-825a5a7e>const</span> params <span class="token operator" data-v-825a5a7e>=</span> arg<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>slice</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token number" data-v-825a5a7e>1</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>[</span><span class="token number" data-v-825a5a7e>0</span><span class="token punctuation" data-v-825a5a7e>]</span>
  console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>&quot;actionFun -&gt; action&quot;</span><span class="token punctuation" data-v-825a5a7e>,</span> action<span class="token punctuation" data-v-825a5a7e>)</span>
  console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>&quot;actionFun -&gt; params&quot;</span><span class="token punctuation" data-v-825a5a7e>,</span> params<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token keyword" data-v-825a5a7e>const</span> options <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>{</span> action<span class="token operator" data-v-825a5a7e>:</span> action<span class="token punctuation" data-v-825a5a7e>,</span> params<span class="token operator" data-v-825a5a7e>:</span> params <span class="token punctuation" data-v-825a5a7e>}</span>
  utilsLibrary<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>getBrowserInfo</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span>type <span class="token operator" data-v-825a5a7e>===</span> <span class="token string" data-v-825a5a7e>'ios'</span> <span class="token operator" data-v-825a5a7e>?</span> <span class="token function" data-v-825a5a7e>iosFunc</span><span class="token punctuation" data-v-825a5a7e>(</span>options<span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>:</span> <span class="token function" data-v-825a5a7e>androidFunc</span><span class="token punctuation" data-v-825a5a7e>(</span>options<span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>

<span class="token comment" data-v-825a5a7e>// 封装好的 H5与安卓之间通信 函数</span>
<span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>androidFunc</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>options<span class="token operator" data-v-825a5a7e>:</span> appFunc</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token keyword" data-v-825a5a7e>const</span> <span class="token punctuation" data-v-825a5a7e>{</span> action<span class="token punctuation" data-v-825a5a7e>,</span> params <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token operator" data-v-825a5a7e>=</span> options
  <span class="token keyword" data-v-825a5a7e>return</span> <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>Promise</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>resolve<span class="token punctuation" data-v-825a5a7e>,</span> reject</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>myWindow<span class="token punctuation" data-v-825a5a7e>.</span>android <span class="token operator" data-v-825a5a7e>&amp;&amp;</span> myWindow<span class="token punctuation" data-v-825a5a7e>.</span>android<span class="token punctuation" data-v-825a5a7e>[</span>action<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token comment" data-v-825a5a7e>// params不能为空、null、undefined, 否则方法会报undefined</span>
      <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>params<span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        myWindow<span class="token punctuation" data-v-825a5a7e>.</span>android<span class="token punctuation" data-v-825a5a7e>[</span>action<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token constant" data-v-825a5a7e>JSON</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>stringify</span><span class="token punctuation" data-v-825a5a7e>(</span>params<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        myWindow<span class="token punctuation" data-v-825a5a7e>.</span>android<span class="token punctuation" data-v-825a5a7e>[</span>action<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token punctuation" data-v-825a5a7e>}</span>
      console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>Android环境--执行</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>成功</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>Android环境--执行</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>成功</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>Error</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>Android环境--未找到方法体</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token function" data-v-825a5a7e>reject</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>Android环境--未找到方法体</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>

<span class="token comment" data-v-825a5a7e>// 封装好的 H5与IOS之间通信 函数</span>
<span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>iosFunc</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>options<span class="token operator" data-v-825a5a7e>:</span> appFunc</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token keyword" data-v-825a5a7e>const</span> <span class="token punctuation" data-v-825a5a7e>{</span> action<span class="token punctuation" data-v-825a5a7e>,</span> params <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token operator" data-v-825a5a7e>=</span> options
  <span class="token keyword" data-v-825a5a7e>return</span> <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>Promise</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>resolve<span class="token punctuation" data-v-825a5a7e>,</span> reject</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>myWindow<span class="token punctuation" data-v-825a5a7e>.</span>webkit <span class="token operator" data-v-825a5a7e>&amp;&amp;</span> myWindow<span class="token punctuation" data-v-825a5a7e>.</span>webkit<span class="token punctuation" data-v-825a5a7e>.</span>messageHandlers <span class="token operator" data-v-825a5a7e>&amp;&amp;</span> myWindow<span class="token punctuation" data-v-825a5a7e>.</span>webkit<span class="token punctuation" data-v-825a5a7e>.</span>messageHandlers<span class="token punctuation" data-v-825a5a7e>[</span>action<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token comment" data-v-825a5a7e>// 无参数的时候, 一定要传一个&quot;&quot;作为参数</span>
      <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>params<span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        myWindow<span class="token punctuation" data-v-825a5a7e>.</span>webkit<span class="token punctuation" data-v-825a5a7e>.</span>messageHandlers<span class="token punctuation" data-v-825a5a7e>[</span>action<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>postMessage</span><span class="token punctuation" data-v-825a5a7e>(</span>params<span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        myWindow<span class="token punctuation" data-v-825a5a7e>.</span>webkit<span class="token punctuation" data-v-825a5a7e>.</span>messageHandlers<span class="token punctuation" data-v-825a5a7e>[</span>action<span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>postMessage</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>''</span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token punctuation" data-v-825a5a7e>}</span>
      console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>IOS环境--执行</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>成功</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>IOS环境--执行</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>成功</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>Error</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>IOS环境--未找到方法体</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token function" data-v-825a5a7e>reject</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>IOS环境--未找到方法体</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>action<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>21</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>22</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>23</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>24</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>25</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>26</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>27</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>28</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>29</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>30</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>31</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>32</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>33</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>34</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>35</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>36</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>37</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>38</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>39</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>40</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>41</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>42</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>43</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>44</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>45</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>46</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>47</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>48</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>想添加app-sdk接口，只需在<code data-v-825a5a7e>appSdk/methods.ts</code>中抛出函数即可。下面以封装好的打开本地相册<code data-v-825a5a7e>openPhotoAlbum</code>函数为例</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token comment" data-v-825a5a7e>/**
 * ```
 * appSDK.openPhotoAlbum(true, res =&gt; {
 *    console.log('res', res)
 * })
// 回调的参数格式：
//{
//  &quot;images&quot;:[
//    {
//      &quot;imageBase64&quot;:图片的base64数据,
//      &quot;imageFormat&quot;:图片格式
//    }
//  ]
//}
 * ```
 * @description 打开本地相册(兼容版本: v3.8.0之后)
 * @param this 
 * @param isNeedCamera 是否需要拍照选项
 * @param openPhotoAlbumCallBack 用户处理打开相册的回调方法
 * @returns 
 */</span>
<span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>openPhotoAlbum</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>isNeedCamera<span class="token operator" data-v-825a5a7e>:</span> boolean <span class="token operator" data-v-825a5a7e>=</span> <span class="token boolean" data-v-825a5a7e>true</span><span class="token punctuation" data-v-825a5a7e>,</span> openPhotoAlbumCallBack<span class="token operator" data-v-825a5a7e>?</span><span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token keyword" data-v-825a5a7e>void</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'test'</span><span class="token punctuation" data-v-825a5a7e>,</span> isNeedCamera<span class="token punctuation" data-v-825a5a7e>,</span> openPhotoAlbumCallBack<span class="token punctuation" data-v-825a5a7e>)</span>
  myWindow<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function-variable function" data-v-825a5a7e>photoCallback</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>res<span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token function" data-v-825a5a7e>openPhotoAlbumCallBack</span><span class="token punctuation" data-v-825a5a7e>(</span>res<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token keyword" data-v-825a5a7e>return</span> <span class="token function" data-v-825a5a7e>actionFun</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'openPhotoAlbum'</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    isNeedCamera
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>21</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>22</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>23</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>24</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>25</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>26</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>27</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>28</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>29</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>30</span><br data-v-825a5a7e></div></div><div class="custom-block tip" data-v-825a5a7e><p class="custom-block-title" data-v-825a5a7e>Tips</p> <p data-v-825a5a7e>目前市面上App的版本都已强更到V3.8.0及以上，对于之前的版本不需要再做兼容</p></div> <h2 id="二、wxsdk" data-v-825a5a7e><a href="#二、wxsdk" class="header-anchor" data-v-825a5a7e>#</a> 二、wxSdk</h2> <p data-v-825a5a7e>目前有微信分享和微信主动授权。在本地测试微信分享的流程：</p> <ul data-v-825a5a7e><li data-v-825a5a7e><a href="https://developers.dingtalk.com/document/resourcedownload/http-intranet-penetration" target="_blank" rel="noopener noreferrer" data-v-825a5a7e>钉钉内网<span data-v-825a5a7e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置代理（其它代理工具也可）。我本地填入<code data-v-825a5a7e>liuwei.vaiwan.com</code></li></ul> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e>http<span class="token operator" data-v-825a5a7e>:</span><span class="token operator" data-v-825a5a7e>/</span><span class="token operator" data-v-825a5a7e>/</span>liuwei<span class="token punctuation" data-v-825a5a7e>.</span>vaiwan<span class="token punctuation" data-v-825a5a7e>.</span>com <span class="token operator" data-v-825a5a7e>-</span><span class="token operator" data-v-825a5a7e>&gt;</span> <span class="token number" data-v-825a5a7e>127.0</span><span class="token number" data-v-825a5a7e>.0</span><span class="token number" data-v-825a5a7e>.1</span><span class="token operator" data-v-825a5a7e>:</span><span class="token number" data-v-825a5a7e>9092</span>
<span class="token comment" data-v-825a5a7e>// start.bat</span>
start <span class="token constant" data-v-825a5a7e>E</span><span class="token operator" data-v-825a5a7e>:</span>\DDing\ddingDownload\钉钉内网\ding<span class="token punctuation" data-v-825a5a7e>.</span>exe <span class="token operator" data-v-825a5a7e>-</span>config<span class="token operator" data-v-825a5a7e>=</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span>ding<span class="token punctuation" data-v-825a5a7e>.</span>cfg <span class="token operator" data-v-825a5a7e>-</span>subdomain<span class="token operator" data-v-825a5a7e>=</span>liuwei <span class="token number" data-v-825a5a7e>9092</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e></div></div><ul data-v-825a5a7e><li data-v-825a5a7e><a href="https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index" target="_blank" rel="noopener noreferrer" data-v-825a5a7e>微信沙箱<span data-v-825a5a7e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置JS接口安全域名。填入钉钉内网配置的域名<code data-v-825a5a7e>liuwei.vaiwan.com</code></li></ul> <p data-v-825a5a7e><img src="data:image/png;base64,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" alt="微信沙箱" data-v-825a5a7e></p> <ol data-v-825a5a7e><li data-v-825a5a7e><p data-v-825a5a7e>微信分享：调<code data-v-825a5a7e>getWechatJsSdkSignature</code>接口获取微信签名信息 --&gt; wx.config --&gt; wx.ready --&gt; wx.onMenuShareAppMessage和wx.onMenuShareTimeline（分享给好友/朋友圈）</p></li> <li data-v-825a5a7e><p data-v-825a5a7e>主动授权获取微信信息。然后把用户微信信息存放到localStorage的wxUserInfo</p></li></ol> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token comment" data-v-825a5a7e>/**
 * @description 授权获取微信用户信息
 * ```
 * getWxUserInfo() {
 *   this.wxSDK.getWxUserInfo({
 *     env: 'TEST', 
 *     redirectUrl: '//liuwei.vaiwan.com/',
 *     appType: '56789', // test环境本人的appType
 *   }).then(res =&gt; {
 *     console.log('res=&gt;', res)
 *   })
 * }
 * ```
 * @param {WxInfoConfig} 
 * @returns 
 */</span>

<span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>getWxUserInfo</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
  env<span class="token punctuation" data-v-825a5a7e>,</span>
  redirectUrl<span class="token punctuation" data-v-825a5a7e>,</span>
  needLogin <span class="token operator" data-v-825a5a7e>=</span> <span class="token boolean" data-v-825a5a7e>false</span><span class="token punctuation" data-v-825a5a7e>,</span>
  appType <span class="token operator" data-v-825a5a7e>=</span> <span class="token string" data-v-825a5a7e>'9'</span>
<span class="token punctuation" data-v-825a5a7e>}</span><span class="token operator" data-v-825a5a7e>:</span> WxInfoConfig<span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  env <span class="token operator" data-v-825a5a7e>=</span> env<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>toUpperCase</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token keyword" data-v-825a5a7e>as</span> Env
  <span class="token keyword" data-v-825a5a7e>const</span> code <span class="token operator" data-v-825a5a7e>=</span> <span class="token function" data-v-825a5a7e>getQueryString</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'code'</span><span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token keyword" data-v-825a5a7e>return</span> <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>Promise</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>resolve<span class="token punctuation" data-v-825a5a7e>,</span> reject</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>code<span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'code==&gt;'</span><span class="token punctuation" data-v-825a5a7e>,</span> needLogin<span class="token punctuation" data-v-825a5a7e>,</span> code<span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token function" data-v-825a5a7e>initHttp</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span> apiType<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'bindApi'</span><span class="token punctuation" data-v-825a5a7e>,</span> env<span class="token operator" data-v-825a5a7e>:</span> env <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token function" data-v-825a5a7e>getWxInfo</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
        code<span class="token punctuation" data-v-825a5a7e>,</span>
        needLogin<span class="token punctuation" data-v-825a5a7e>,</span>
        appType<span class="token punctuation" data-v-825a5a7e>,</span>
      <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>then</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>res<span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>[</span><span class="token number" data-v-825a5a7e>0</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token number" data-v-825a5a7e>200</span><span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>includes</span><span class="token punctuation" data-v-825a5a7e>(</span>res<span class="token punctuation" data-v-825a5a7e>.</span>code<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
          <span class="token comment" data-v-825a5a7e>// 保存用户微信信息</span>
          localStorage<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>setItem</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'wxUserInfo'</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token constant" data-v-825a5a7e>JSON</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>stringify</span><span class="token punctuation" data-v-825a5a7e>(</span>res<span class="token punctuation" data-v-825a5a7e>.</span>data<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>)</span>
          <span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span>res<span class="token punctuation" data-v-825a5a7e>.</span>data<span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
          <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>res<span class="token punctuation" data-v-825a5a7e>.</span>msg <span class="token operator" data-v-825a5a7e>===</span> <span class="token string" data-v-825a5a7e>'获取OpenId失败'</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
            window<span class="token punctuation" data-v-825a5a7e>.</span>location<span class="token punctuation" data-v-825a5a7e>.</span>href <span class="token operator" data-v-825a5a7e>=</span> <span class="token function" data-v-825a5a7e>getWxRedirectUrl</span><span class="token punctuation" data-v-825a5a7e>(</span>redirectUrl<span class="token punctuation" data-v-825a5a7e>,</span> <span class="token string" data-v-825a5a7e>'snsapi_userinfo'</span><span class="token punctuation" data-v-825a5a7e>,</span> env<span class="token punctuation" data-v-825a5a7e>)</span>
            <span class="token keyword" data-v-825a5a7e>return</span>
          <span class="token punctuation" data-v-825a5a7e>}</span>
          <span class="token function" data-v-825a5a7e>reject</span><span class="token punctuation" data-v-825a5a7e>(</span>res<span class="token punctuation" data-v-825a5a7e>.</span>msg<span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token punctuation" data-v-825a5a7e>}</span>
      <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>catch</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>e</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'wxSDK -&gt; getWxUserInfo'</span><span class="token punctuation" data-v-825a5a7e>,</span> e<span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token function" data-v-825a5a7e>reject</span><span class="token punctuation" data-v-825a5a7e>(</span>e<span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      window<span class="token punctuation" data-v-825a5a7e>.</span>location<span class="token punctuation" data-v-825a5a7e>.</span>href <span class="token operator" data-v-825a5a7e>=</span> <span class="token function" data-v-825a5a7e>getWxRedirectUrl</span><span class="token punctuation" data-v-825a5a7e>(</span>redirectUrl<span class="token punctuation" data-v-825a5a7e>,</span> <span class="token string" data-v-825a5a7e>'snsapi_userinfo'</span><span class="token punctuation" data-v-825a5a7e>,</span> env<span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>21</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>22</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>23</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>24</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>25</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>26</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>27</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>28</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>29</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>30</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>31</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>32</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>33</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>34</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>35</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>36</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>37</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>38</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>39</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>40</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>41</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>42</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>43</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>44</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>45</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>46</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>47</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>48</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>49</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>50</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>51</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>52</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>53</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>54</span><br data-v-825a5a7e></div></div><h2 id="三、loginsdk" data-v-825a5a7e><a href="#三、loginsdk" class="header-anchor" data-v-825a5a7e>#</a> 三、loginSdk</h2> <p data-v-825a5a7e><a href="./common-login-h5" data-v-825a5a7e>统一登陆h5及业务了解</a>。基本上目前开发的所有H5都需要接入登陆统一。业务H5需要引入Banner条，及相关的登陆逻辑。这部分我们封装到loginSdk.</p> <p data-v-825a5a7e>下面重点讲以下三点的实现：</p> <ol data-v-825a5a7e><li data-v-825a5a7e>app和H5的统一登录参数处理【将app token 换成 统一登录的 token】</li> <li data-v-825a5a7e>统一登陆业务banner条设计</li> <li data-v-825a5a7e>统一登录页面互相跳转函数</li></ol> <h3 id="app内嵌h5" data-v-825a5a7e><a href="#app内嵌h5" class="header-anchor" data-v-825a5a7e>#</a> app内嵌H5</h3> <p data-v-825a5a7e>H5可配置在app不同的入口；前面六种入口的配置位于六一工作台-运营管理-APP广告位管理</p> <ol data-v-825a5a7e><li data-v-825a5a7e>首页Banner</li> <li data-v-825a5a7e>首页快速入口</li> <li data-v-825a5a7e>首页浮标管理</li> <li data-v-825a5a7e>首页广告弹窗</li> <li data-v-825a5a7e>App启动页</li> <li data-v-825a5a7e>App消息推送：App推送的通知消息点击进入</li></ol> <p data-v-825a5a7e>为了实现app中的H5打开时，就需要是已登陆的状态。需要用app的token去获取统一登陆的token。app内的每个webview都会在url后自动拼接上用户基本信息，拼接完后的url为</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e> https<span class="token operator" data-v-825a5a7e>:</span><span class="token operator" data-v-825a5a7e>/</span><span class="token operator" data-v-825a5a7e>/</span>www<span class="token punctuation" data-v-825a5a7e>.</span>xxx<span class="token punctuation" data-v-825a5a7e>.</span>com<span class="token operator" data-v-825a5a7e>?</span>参数<span class="token operator" data-v-825a5a7e>=</span>参数值<span class="token operator" data-v-825a5a7e>&amp;</span>hllUserInfo<span class="token operator" data-v-825a5a7e>=</span><span class="token punctuation" data-v-825a5a7e>{</span>“userId”<span class="token operator" data-v-825a5a7e>:</span>userId<span class="token punctuation" data-v-825a5a7e>,</span><span class="token string" data-v-825a5a7e>&quot;token&quot;</span><span class="token operator" data-v-825a5a7e>:</span>token<span class="token punctuation" data-v-825a5a7e>,</span><span class="token string" data-v-825a5a7e>&quot;deviceId&quot;</span><span class="token operator" data-v-825a5a7e>:</span>deviceId<span class="token string" data-v-825a5a7e>&quot;versionCode&quot;</span><span class="token operator" data-v-825a5a7e>:</span>versionCode<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>如上所示，app的token放在<code data-v-825a5a7e>hllUserInfo</code>参数内。But。。。由于app历史问题吧，有的入口token会放在<code data-v-825a5a7e>params</code>内。因此需要做下处理。目前3.9.0版本后已经有统一的参数传递规范：https://wiki.61info.cn/pages/viewpage.action?pageId=16188959</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>initToken</span><span class="token punctuation" data-v-825a5a7e>(</span>env<span class="token operator" data-v-825a5a7e>:</span> Env <span class="token operator" data-v-825a5a7e>=</span> <span class="token string" data-v-825a5a7e>'PROD'</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token operator" data-v-825a5a7e>:</span> Promise<span class="token operator" data-v-825a5a7e>&lt;</span>InitTokenResponse<span class="token operator" data-v-825a5a7e>&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token keyword" data-v-825a5a7e>const</span> href <span class="token operator" data-v-825a5a7e>=</span> window<span class="token punctuation" data-v-825a5a7e>.</span>location<span class="token punctuation" data-v-825a5a7e>.</span>href
  env <span class="token operator" data-v-825a5a7e>=</span> env<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>toUpperCase</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token keyword" data-v-825a5a7e>as</span> Env
  console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'window.location.href'</span><span class="token punctuation" data-v-825a5a7e>,</span> window<span class="token punctuation" data-v-825a5a7e>.</span>location<span class="token punctuation" data-v-825a5a7e>.</span>href<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token keyword" data-v-825a5a7e>const</span> queryObj <span class="token operator" data-v-825a5a7e>=</span> <span class="token function" data-v-825a5a7e>decodeObj</span><span class="token punctuation" data-v-825a5a7e>(</span>utilsLibrary<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>parseQueryString</span><span class="token punctuation" data-v-825a5a7e>(</span>href<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>)</span>
  console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'queryObj===&gt;'</span><span class="token punctuation" data-v-825a5a7e>,</span> queryObj<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token keyword" data-v-825a5a7e>const</span> <span class="token function-variable function" data-v-825a5a7e>getUrlInfo</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token keyword" data-v-825a5a7e>let</span> appData<span class="token operator" data-v-825a5a7e>:</span> string <span class="token operator" data-v-825a5a7e>=</span> <span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>{}</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span>
    <span class="token comment" data-v-825a5a7e>// 获取参数对象。token场景不同，只能做兼容了。。。</span>
    <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'hllUserInfo'</span><span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span> <span class="token comment" data-v-825a5a7e>// v3.9.0添加</span>
      appData <span class="token operator" data-v-825a5a7e>=</span> queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'hllUserInfo'</span><span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>||</span> <span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>{}</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span>
    <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'params'</span><span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span> <span class="token comment" data-v-825a5a7e>// v3.9.0之前</span>
      appData <span class="token operator" data-v-825a5a7e>=</span> queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'params'</span><span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>||</span> <span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>{}</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span>
    <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'ssoUserInfo'</span><span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token comment" data-v-825a5a7e>// H5跳转入口，ssoUserInfo内有统一登录ssoUserToken</span>
      appData <span class="token operator" data-v-825a5a7e>=</span> queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'ssoUserInfo'</span><span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>||</span> <span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>{}</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span>
    <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'Authorization'</span><span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span> <span class="token comment" data-v-825a5a7e>// 消息推送入口</span>
      appData <span class="token operator" data-v-825a5a7e>=</span> <span class="token constant" data-v-825a5a7e>JSON</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>stringify</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
        token<span class="token operator" data-v-825a5a7e>:</span> queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'Authorization'</span><span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>,</span>
        deviceId<span class="token operator" data-v-825a5a7e>:</span> queryObj<span class="token punctuation" data-v-825a5a7e>[</span><span class="token string" data-v-825a5a7e>'deviceId'</span><span class="token punctuation" data-v-825a5a7e>]</span>
      <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
    <span class="token keyword" data-v-825a5a7e>return</span> <span class="token constant" data-v-825a5a7e>JSON</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>parse</span><span class="token punctuation" data-v-825a5a7e>(</span>appData<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token keyword" data-v-825a5a7e>const</span> urlInfo<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>{</span> token<span class="token operator" data-v-825a5a7e>:</span> string<span class="token punctuation" data-v-825a5a7e>,</span> deviceId<span class="token operator" data-v-825a5a7e>:</span> string <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token operator" data-v-825a5a7e>=</span> <span class="token function" data-v-825a5a7e>getUrlInfo</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token comment" data-v-825a5a7e>// 链接上带的信息</span>
  console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'BaseSDK -&gt; initToken -&gt; urlInfo'</span><span class="token punctuation" data-v-825a5a7e>,</span>env<span class="token punctuation" data-v-825a5a7e>,</span> urlInfo<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token function" data-v-825a5a7e>initHttp</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span> apiType<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'appApi'</span><span class="token punctuation" data-v-825a5a7e>,</span> env <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token keyword" data-v-825a5a7e>return</span> <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>Promise</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>resolve<span class="token punctuation" data-v-825a5a7e>,</span> reject</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token comment" data-v-825a5a7e>// 用url链接上app token 换 统一登陆token</span>
    <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>urlInfo<span class="token punctuation" data-v-825a5a7e>.</span>token<span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token function" data-v-825a5a7e>getToken</span><span class="token punctuation" data-v-825a5a7e>(</span>urlInfo<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>then</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>ssoRes<span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'BaseSDK -&gt; initToken -&gt; 统一登陆ssoRes信息：'</span><span class="token punctuation" data-v-825a5a7e>,</span> ssoRes<span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>ssoRes<span class="token punctuation" data-v-825a5a7e>.</span>code <span class="token operator" data-v-825a5a7e>!==</span> <span class="token number" data-v-825a5a7e>200</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
          <span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
            ssoUserToken<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>''</span><span class="token punctuation" data-v-825a5a7e>,</span>
            msg<span class="token operator" data-v-825a5a7e>:</span> ssoRes<span class="token punctuation" data-v-825a5a7e>.</span>msg
          <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
          <span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
            msg<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'登录成功'</span><span class="token punctuation" data-v-825a5a7e>,</span>
            ssoUserToken<span class="token operator" data-v-825a5a7e>:</span> ssoRes<span class="token punctuation" data-v-825a5a7e>.</span>data
          <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token punctuation" data-v-825a5a7e>}</span>
      <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>catch</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>err<span class="token operator" data-v-825a5a7e>:</span> any</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
        console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'BaseSDK -&gt; initToken -&gt; err'</span><span class="token punctuation" data-v-825a5a7e>,</span> err<span class="token punctuation" data-v-825a5a7e>)</span>
        <span class="token function" data-v-825a5a7e>reject</span><span class="token punctuation" data-v-825a5a7e>(</span>err<span class="token punctuation" data-v-825a5a7e>)</span>
      <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span> <span class="token keyword" data-v-825a5a7e>else</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      <span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
        ssoUserToken<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>''</span><span class="token punctuation" data-v-825a5a7e>,</span>
        msg<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'url链接未带有app的token参数'</span>
      <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>21</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>22</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>23</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>24</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>25</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>26</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>27</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>28</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>29</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>30</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>31</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>32</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>33</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>34</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>35</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>36</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>37</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>38</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>39</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>40</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>41</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>42</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>43</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>44</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>45</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>46</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>47</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>48</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>49</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>50</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>51</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>52</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>53</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>54</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>55</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e><code data-v-825a5a7e>getUrlInfo</code>针对app不同入口兼容处理，目的是获取app的token; 然后调<code data-v-825a5a7e>getToken</code>接口，用app的token去获取统一登陆的token</p> <h2 id="登陆banner" data-v-825a5a7e><a href="#登陆banner" class="header-anchor" data-v-825a5a7e>#</a> 登陆Banner</h2> <h3 id="register-页面注册。可根据配置是否显示登陆banner-登陆状态-及微信登陆相关等" data-v-825a5a7e><a href="#register-页面注册。可根据配置是否显示登陆banner-登陆状态-及微信登陆相关等" class="header-anchor" data-v-825a5a7e>#</a> register 页面注册。可根据配置是否显示登陆banner，登陆状态，及微信登陆相关等</h3> <ul data-v-825a5a7e><li data-v-825a5a7e>传参：option（可供选择的属性值如下）</li></ul> <table data-v-825a5a7e><thead data-v-825a5a7e><tr data-v-825a5a7e><th data-v-825a5a7e>参数</th> <th data-v-825a5a7e>描述</th> <th data-v-825a5a7e>类型</th> <th data-v-825a5a7e>必传</th> <th data-v-825a5a7e>默认值</th></tr></thead> <tbody data-v-825a5a7e><tr data-v-825a5a7e><td data-v-825a5a7e>env</td> <td data-v-825a5a7e>环境变量<code data-v-825a5a7e>DEV</code>, <code data-v-825a5a7e>TEST</code>, <code data-v-825a5a7e>PRE</code>, <code data-v-825a5a7e>PROD</code></td> <td data-v-825a5a7e>string</td> <td data-v-825a5a7e>必传(虽然默认值为PROD, 但建议要传)</td> <td data-v-825a5a7e><code data-v-825a5a7e>PROD</code></td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>redirectUrl</td> <td data-v-825a5a7e>业务H5地址</td> <td data-v-825a5a7e>string</td> <td data-v-825a5a7e>必传</td> <td data-v-825a5a7e>-</td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>appType</td> <td data-v-825a5a7e>公众号类型（'9': 画啦啦VIP课堂；'3306': 分销平台）</td> <td data-v-825a5a7e>string</td> <td data-v-825a5a7e>非必传</td> <td data-v-825a5a7e>'9'</td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>isShow</td> <td data-v-825a5a7e>是否显示弹窗</td> <td data-v-825a5a7e>boolean</td> <td data-v-825a5a7e>非必传</td> <td data-v-825a5a7e>true</td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>zIndex</td> <td data-v-825a5a7e>顶部栏层级</td> <td data-v-825a5a7e>number或string</td> <td data-v-825a5a7e>非必传</td> <td data-v-825a5a7e>199</td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>maxInitTime</td> <td data-v-825a5a7e>最大初始化时间</td> <td data-v-825a5a7e>number</td> <td data-v-825a5a7e>非必传</td> <td data-v-825a5a7e>2</td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>wxAutoLogin</td> <td data-v-825a5a7e>是否开启自动登录</td> <td data-v-825a5a7e>boolean</td> <td data-v-825a5a7e>非必传</td> <td data-v-825a5a7e>false</td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>wxAutoLoginType</td> <td data-v-825a5a7e>微信登录模式  1: 静默授权, 2: 主动授权(会返回openId相关信息) 默认为1</td> <td data-v-825a5a7e>number</td> <td data-v-825a5a7e>非必传</td> <td data-v-825a5a7e>1</td></tr> <tr data-v-825a5a7e><td data-v-825a5a7e>wxAutoLoginRedirectUrl</td> <td data-v-825a5a7e>微信自动登录后的回调地址</td> <td data-v-825a5a7e>string</td> <td data-v-825a5a7e>当wxAutoLogin为true时必传</td> <td data-v-825a5a7e>-</td></tr></tbody></table> <h3 id="设计" data-v-825a5a7e><a href="#设计" class="header-anchor" data-v-825a5a7e>#</a> 设计</h3> <p data-v-825a5a7e><img src="/font-docs/assets/img/18.11cb2587.png" alt="loginSdk" data-v-825a5a7e></p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token class-name" data-v-825a5a7e>Vue</span><span class="token punctuation" data-v-825a5a7e>.</span>prototype<span class="token punctuation" data-v-825a5a7e>.</span>LoginSDK<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>register</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
  env<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'TEST'</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token comment" data-v-825a5a7e>// 环境变量</span>
  redirectUrl<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'//liuwei.vaiwan.com/'</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token comment" data-v-825a5a7e>// 统一登录后的回调地址</span>
  isShow<span class="token operator" data-v-825a5a7e>:</span> <span class="token boolean" data-v-825a5a7e>true</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token comment" data-v-825a5a7e>// 是否展示顶部栏</span>
  zIndex<span class="token operator" data-v-825a5a7e>:</span> <span class="token number" data-v-825a5a7e>199</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token comment" data-v-825a5a7e>// 顶部栏的 Z-Index</span>
  appType<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'56789'</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token comment" data-v-825a5a7e>// 程亮测试用appType</span>
  wxAutoLogin<span class="token operator" data-v-825a5a7e>:</span> <span class="token boolean" data-v-825a5a7e>true</span><span class="token punctuation" data-v-825a5a7e>,</span>
  wxAutoLoginType<span class="token operator" data-v-825a5a7e>:</span> <span class="token number" data-v-825a5a7e>1</span><span class="token punctuation" data-v-825a5a7e>,</span>
  wxAutoLoginRedirectUrl<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'//liuwei.vaiwan.com/'</span><span class="token punctuation" data-v-825a5a7e>,</span>
<span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>then</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>res</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  console<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>log</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'register res==&gt;'</span><span class="token punctuation" data-v-825a5a7e>,</span> res<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token keyword" data-v-825a5a7e>new</span> <span class="token class-name" data-v-825a5a7e>Vue</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token function-variable function" data-v-825a5a7e>render</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token parameter" data-v-825a5a7e>h</span> <span class="token operator" data-v-825a5a7e>=&gt;</span> <span class="token function" data-v-825a5a7e>h</span><span class="token punctuation" data-v-825a5a7e>(</span>App<span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>$mount</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'#app'</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e></div></div><h2 id="loginsdk难点" data-v-825a5a7e><a href="#loginsdk难点" class="header-anchor" data-v-825a5a7e>#</a> loginSdk难点</h2> <h3 id="_1-app端-两个token的续登机制" data-v-825a5a7e><a href="#_1-app端-两个token的续登机制" class="header-anchor" data-v-825a5a7e>#</a> 1. app端，两个token的续登机制</h3> <p data-v-825a5a7e>在loginSdk.register初始化时，需要用userToken去获取用户信息，才能登陆。</p> <ul data-v-825a5a7e><li data-v-825a5a7e>在H5下，从登陆页登陆成功后，回跳到业务H5页面，链接会带有userToken</li> <li data-v-825a5a7e>在app内嵌H5下，就有<code data-v-825a5a7e>双token机制</code>，即app token -&gt; userToken -&gt; 用户信息</li></ul> <h3 id="_2-多个微信号切换-微信信息串号" data-v-825a5a7e><a href="#_2-多个微信号切换-微信信息串号" class="header-anchor" data-v-825a5a7e>#</a> 2. 多个微信号切换，微信信息串号</h3> <p data-v-825a5a7e>2-1. 在微信环境下，开启微信登陆，默认是用无感知的静默授权。走 code -&gt; userToken -&gt; 用户信息。把userToken存在本地。</p> <p data-v-825a5a7e>2-2. 只需最开初进入页面做一次静默授权即可。再次进入时，用本地userToken，去获取用户信息即可。如果本地没有userToken，则走2-1</p> <p data-v-825a5a7e>起初是用上面的方案，但上线后有<strong data-v-825a5a7e>问题</strong>：<code data-v-825a5a7e>一些用户有多个微信号，当切换账号时会出现数据串号</code>。</p> <p data-v-825a5a7e><strong data-v-825a5a7e>原因</strong>：<code data-v-825a5a7e>有些机型下，切换微信账号，但微信的localStorage不会清空</code></p> <p data-v-825a5a7e>A微信 切换到 B微信，localStorage不清空，B微信进入页面，用A微信的userToken去获取用户信息。就出现串号了！</p> <p data-v-825a5a7e><a href="https://developers.weixin.qq.com/community/develop/doc/00006c5e2a4da08a5db90a2105bc00" target="_blank" rel="noopener noreferrer" data-v-825a5a7e>部分机型，切换账号后，H5公众号应用，localStorage数据未清空，导致应用登录状态不正确<span data-v-825a5a7e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p data-v-825a5a7e><strong data-v-825a5a7e>解决</strong>：cookie方案。切换微信号，cookie会清除。userToken保存到localStorage时，也保存到Cookie</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token comment" data-v-825a5a7e>// 为了区分不同的业务H5</span>
<span class="token keyword" data-v-825a5a7e>const</span> cookiesPathName <span class="token operator" data-v-825a5a7e>=</span> location<span class="token punctuation" data-v-825a5a7e>.</span>pathname<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>substring</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token number" data-v-825a5a7e>0</span><span class="token punctuation" data-v-825a5a7e>,</span> location<span class="token punctuation" data-v-825a5a7e>.</span>pathname<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>lastIndexOf</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'/'</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>)</span>

<span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>setCookie</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>key<span class="token punctuation" data-v-825a5a7e>,</span> value</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  Cookies<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>set</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>cookiesPathName<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>-</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>key<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>,</span> value <span class="token punctuation" data-v-825a5a7e>,</span> <span class="token punctuation" data-v-825a5a7e>{</span> path<span class="token operator" data-v-825a5a7e>:</span> cookiesPathName <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>

<span class="token keyword" data-v-825a5a7e>function</span> <span class="token function" data-v-825a5a7e>getCookie</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token parameter" data-v-825a5a7e>key</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token keyword" data-v-825a5a7e>return</span> Cookies<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>get</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>cookiesPathName<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>-</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span>key<span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
<span class="token function" data-v-825a5a7e>setCookie</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'userToken'</span><span class="token punctuation" data-v-825a5a7e>,</span> userToken<span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token function" data-v-825a5a7e>removeCookie</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'userToken'</span><span class="token punctuation" data-v-825a5a7e>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e></div></div><h3 id="_3-token过期如何处理" data-v-825a5a7e><a href="#_3-token过期如何处理" class="header-anchor" data-v-825a5a7e>#</a> 3. token过期如何处理</h3> <p data-v-825a5a7e>用userToken获取用户信息时，约定<code data-v-825a5a7e>code: 621</code>为userToken过期。</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>res<span class="token punctuation" data-v-825a5a7e>.</span>code <span class="token operator" data-v-825a5a7e>===</span> <span class="token number" data-v-825a5a7e>621</span><span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token keyword" data-v-825a5a7e>if</span> <span class="token punctuation" data-v-825a5a7e>(</span>browser<span class="token punctuation" data-v-825a5a7e>.</span>versions<span class="token punctuation" data-v-825a5a7e>.</span>weixin <span class="token operator" data-v-825a5a7e>&amp;&amp;</span> <span class="token keyword" data-v-825a5a7e>this</span><span class="token punctuation" data-v-825a5a7e>.</span>def<span class="token punctuation" data-v-825a5a7e>.</span>wxAutoLogin<span class="token punctuation" data-v-825a5a7e>)</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    <span class="token function" data-v-825a5a7e>removeCookie</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'userToken'</span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token keyword" data-v-825a5a7e>this</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>wxAutoLogin</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token keyword" data-v-825a5a7e>return</span>
  <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token keyword" data-v-825a5a7e>this</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>refeshTokenHandle</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token punctuation" data-v-825a5a7e>}</span> 
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>3-1. 微信环境下并且开启了自动登陆。则再走一遍：code -&gt; userToken(保存到本地)</p> <p data-v-825a5a7e>3-2. 否则，调接口获取新的userToken并保存</p> <h3 id="_4-登陆加密。为了避免密码泄露。" data-v-825a5a7e><a href="#_4-登陆加密。为了避免密码泄露。" class="header-anchor" data-v-825a5a7e>#</a> 4. 登陆加密。为了避免密码泄露。</h3> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token keyword" data-v-825a5a7e>import</span> md5 <span class="token keyword" data-v-825a5a7e>from</span> <span class="token string" data-v-825a5a7e>'js-md5'</span>
<span class="token function" data-v-825a5a7e>request</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token punctuation" data-v-825a5a7e>{</span>
  url<span class="token operator" data-v-825a5a7e>:</span> <span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>/user/processLogin</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span><span class="token punctuation" data-v-825a5a7e>,</span>
  method<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'post'</span><span class="token punctuation" data-v-825a5a7e>,</span>
  data<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    account<span class="token operator" data-v-825a5a7e>:</span> <span class="token keyword" data-v-825a5a7e>this</span><span class="token punctuation" data-v-825a5a7e>.</span>form<span class="token punctuation" data-v-825a5a7e>.</span>phone<span class="token punctuation" data-v-825a5a7e>,</span>
    loginEnv<span class="token operator" data-v-825a5a7e>:</span> <span class="token keyword" data-v-825a5a7e>this</span><span class="token punctuation" data-v-825a5a7e>.</span>loginEnv<span class="token punctuation" data-v-825a5a7e>,</span>
    password<span class="token operator" data-v-825a5a7e>:</span> <span class="token function" data-v-825a5a7e>md5</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token keyword" data-v-825a5a7e>this</span><span class="token punctuation" data-v-825a5a7e>.</span>form<span class="token punctuation" data-v-825a5a7e>.</span>pwd<span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>,</span>
<span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e></div></div><h3 id="_5-中间页去获取code" data-v-825a5a7e><a href="#_5-中间页去获取code" class="header-anchor" data-v-825a5a7e>#</a> 5. 中间页去获取code</h3> <p data-v-825a5a7e>由于授权域名回调只能填写一个。因此，授权页不能在业务H5上，因为业务H5的域名远不止一个。</p> <p data-v-825a5a7e><img src="/font-docs/assets/img/20.5ac895ee.gif" alt="授权" data-v-825a5a7e></p> <p data-v-825a5a7e>实现：用一个中转页，<code data-v-825a5a7e>微信授权后跳到中转页，中转业获取到state, code后，再跳转到业务H5页面</code>。中转页放到授权域名下，统一维护授权中转页。</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token comment" data-v-825a5a7e>// 中转页网址。即h5-sdk部署地方</span>
<span class="token keyword" data-v-825a5a7e>export</span> <span class="token keyword" data-v-825a5a7e>const</span> transferPageConfig<span class="token operator" data-v-825a5a7e>:</span> Api <span class="token operator" data-v-825a5a7e>=</span> <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token constant" data-v-825a5a7e>DEV</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'//pay-test.61info.cn/common-login-dev'</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token constant" data-v-825a5a7e>TEST</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'//liuwei.vaiwan.com'</span><span class="token punctuation" data-v-825a5a7e>,</span> <span class="token comment" data-v-825a5a7e>// 本地测试用</span>
  <span class="token comment" data-v-825a5a7e>// TEST: '//pay-test.61info.cn/common-login-test',</span>
  <span class="token constant" data-v-825a5a7e>PRE</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'//pay-test.61info.cn/common-login-pre'</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token constant" data-v-825a5a7e>PROD</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'//pay.61info.cn/common-login'</span>
<span class="token punctuation" data-v-825a5a7e>}</span>

<span class="token keyword" data-v-825a5a7e>const</span> commonRedirectUrl<span class="token operator" data-v-825a5a7e>:</span> string <span class="token operator" data-v-825a5a7e>=</span> location<span class="token punctuation" data-v-825a5a7e>.</span>protocol <span class="token operator" data-v-825a5a7e>+</span> transferPageConfig<span class="token punctuation" data-v-825a5a7e>[</span>env<span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>+</span> <span class="token string" data-v-825a5a7e>'/static/wxTransfer.html'</span>
<span class="token keyword" data-v-825a5a7e>const</span> redirectUrlElement <span class="token operator" data-v-825a5a7e>=</span> document<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>createElement</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'a'</span><span class="token punctuation" data-v-825a5a7e>)</span>
redirectUrlElement<span class="token punctuation" data-v-825a5a7e>.</span>href <span class="token operator" data-v-825a5a7e>=</span> <span class="token function" data-v-825a5a7e>decodeURIComponent</span><span class="token punctuation" data-v-825a5a7e>(</span>redirectUrl<span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token comment" data-v-825a5a7e>// 因为state参数限制长度在128字节, 所以将链接上的参数统一放入redirect_uri上, 经过中间层解析后再转移到业务的url上去</span>
<span class="token keyword" data-v-825a5a7e>const</span> origin <span class="token operator" data-v-825a5a7e>=</span> redirectUrlElement<span class="token punctuation" data-v-825a5a7e>.</span>origin <span class="token operator" data-v-825a5a7e>+</span> redirectUrlElement<span class="token punctuation" data-v-825a5a7e>.</span>pathname <span class="token operator" data-v-825a5a7e>+</span> <span class="token punctuation" data-v-825a5a7e>(</span>redirectUrlElement<span class="token punctuation" data-v-825a5a7e>.</span>hash<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>split</span><span class="token punctuation" data-v-825a5a7e>(</span><span class="token string" data-v-825a5a7e>'?'</span><span class="token punctuation" data-v-825a5a7e>)</span><span class="token punctuation" data-v-825a5a7e>[</span><span class="token number" data-v-825a5a7e>0</span><span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>||</span> <span class="token string" data-v-825a5a7e>''</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token keyword" data-v-825a5a7e>return</span> <span class="token template-string" data-v-825a5a7e><span class="token template-punctuation string" data-v-825a5a7e>`</span><span class="token string" data-v-825a5a7e>https://open.weixin.qq.com/connect/oauth2/authorize?appid=xxx&amp;redirect_uri=</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span><span class="token function" data-v-825a5a7e>encodeURIComponent</span><span class="token punctuation" data-v-825a5a7e>(</span>commonRedirectUrl<span class="token punctuation" data-v-825a5a7e>)</span><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>&amp;response_type=code&amp;scope=xxx&amp;state=</span><span class="token interpolation" data-v-825a5a7e><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>${</span><span class="token function" data-v-825a5a7e>encodeURIComponent</span><span class="token punctuation" data-v-825a5a7e>(</span>origin<span class="token punctuation" data-v-825a5a7e>)</span><span class="token interpolation-punctuation punctuation" data-v-825a5a7e>}</span></span><span class="token string" data-v-825a5a7e>#wechat_redirect</span><span class="token template-punctuation string" data-v-825a5a7e>`</span></span>

</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e></div></div><h3 id="_6-业务h5页面带了很多参数-授权回来后你怎么处理呢" data-v-825a5a7e><a href="#_6-业务h5页面带了很多参数-授权回来后你怎么处理呢" class="header-anchor" data-v-825a5a7e>#</a> 6. 业务H5页面带了很多参数，授权回来后你怎么处理呢</h3> <p data-v-825a5a7e>起初，放state里， 但state有128长度限制。</p> <p data-v-825a5a7e><img src="data:image/png;base64,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" alt="state" data-v-825a5a7e></p> <p data-v-825a5a7e><strong data-v-825a5a7e>解决</strong>：把链接的参数拼接好，放<code data-v-825a5a7e>redirect_uri</code>后面</p> <h2 id="打包优化" data-v-825a5a7e><a href="#打包优化" class="header-anchor" data-v-825a5a7e>#</a> 打包优化</h2> <ol data-v-825a5a7e><li data-v-825a5a7e>外部拓展<code data-v-825a5a7e>externals</code>, 将h5-sdk用到的第三方库放到外部拓展. 减少打包体积</li></ol> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e>externals<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>[</span>
  <span class="token string" data-v-825a5a7e>&quot;axios&quot;</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token string" data-v-825a5a7e>&quot;weixin-jsapi&quot;</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token string" data-v-825a5a7e>'@i61/utils-library'</span>
<span class="token punctuation" data-v-825a5a7e>]</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e></div></div><ol start="2" data-v-825a5a7e><li data-v-825a5a7e>babel做代码编译</li></ol> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token comment" data-v-825a5a7e>// build/webpack.config.js</span>
rules<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>[</span>
  <span class="token punctuation" data-v-825a5a7e>{</span>
    test<span class="token operator" data-v-825a5a7e>:</span> <span class="token regex" data-v-825a5a7e><span class="token regex-delimiter" data-v-825a5a7e>/</span><span class="token regex-source language-regex" data-v-825a5a7e>\.(ts|js)x?$</span><span class="token regex-delimiter" data-v-825a5a7e>/</span></span><span class="token punctuation" data-v-825a5a7e>,</span>
    exclude<span class="token operator" data-v-825a5a7e>:</span> <span class="token regex" data-v-825a5a7e><span class="token regex-delimiter" data-v-825a5a7e>/</span><span class="token regex-source language-regex" data-v-825a5a7e>node_modules</span><span class="token regex-delimiter" data-v-825a5a7e>/</span></span><span class="token punctuation" data-v-825a5a7e>,</span>
    use<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      loader<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'babel-loader'</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token punctuation" data-v-825a5a7e>}</span>
<span class="token punctuation" data-v-825a5a7e>]</span>
<span class="token comment" data-v-825a5a7e>// babel.config.js</span>
<span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token string" data-v-825a5a7e>&quot;presets&quot;</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>[</span>
    <span class="token punctuation" data-v-825a5a7e>[</span>
      <span class="token string" data-v-825a5a7e>&quot;@babel/preset-env&quot;</span><span class="token punctuation" data-v-825a5a7e>,</span>
      <span class="token comment" data-v-825a5a7e>// {</span>
      <span class="token comment" data-v-825a5a7e>//   &quot;useBuiltIns&quot;: &quot;usage&quot;,</span>
      <span class="token comment" data-v-825a5a7e>//   &quot;corejs&quot;: &quot;3.8&quot;,</span>
      <span class="token comment" data-v-825a5a7e>//   &quot;modules&quot;: &quot;auto&quot;</span>
      <span class="token comment" data-v-825a5a7e>// }</span>
    <span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>,</span>
    <span class="token punctuation" data-v-825a5a7e>[</span>
      <span class="token string" data-v-825a5a7e>&quot;@babel/preset-typescript&quot;</span><span class="token punctuation" data-v-825a5a7e>,</span>
      <span class="token punctuation" data-v-825a5a7e>{</span>
        <span class="token string" data-v-825a5a7e>&quot;isTSX&quot;</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token boolean" data-v-825a5a7e>true</span><span class="token punctuation" data-v-825a5a7e>,</span>
        <span class="token string" data-v-825a5a7e>&quot;allExtensions&quot;</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token boolean" data-v-825a5a7e>true</span>
      <span class="token punctuation" data-v-825a5a7e>}</span>
    <span class="token punctuation" data-v-825a5a7e>]</span>
  <span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>,</span>
  <span class="token string" data-v-825a5a7e>&quot;plugins&quot;</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>[</span>
    <span class="token comment" data-v-825a5a7e>// &quot;@babel/plugin-transform-modules-umd&quot;,</span>
    <span class="token string" data-v-825a5a7e>&quot;@babel/plugin-transform-runtime&quot;</span>
  <span class="token punctuation" data-v-825a5a7e>]</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>21</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>22</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>23</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>24</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>25</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>26</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>27</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>28</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>29</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>30</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>31</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>32</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>33</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>34</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>最开始用了<code data-v-825a5a7e>useBuiltIns: &quot;usage&quot;</code>，打包出来有<code data-v-825a5a7e>65KB</code>。再来复习下这个参数<a href="/font-docs/babel/#babel-polyfill" data-v-825a5a7e>babel</a></p> <ul data-v-825a5a7e><li data-v-825a5a7e>默认为false: 不做polyfill</li> <li data-v-825a5a7e>entry: 考虑目标环境缺失的API模块, 引入相关的API的polyfill</li> <li data-v-825a5a7e>usage: 只有使用到的ES6特性API在目标环境缺失的时候, 才引入polyfill</li></ul> <p data-v-825a5a7e>去掉<code data-v-825a5a7e>useBuiltIns</code>参数，不引入polyfill，打包出来有<code data-v-825a5a7e>29KB</code></p> <h2 id="打包难点" data-v-825a5a7e><a href="#打包难点" class="header-anchor" data-v-825a5a7e>#</a> 打包难点</h2> <p data-v-825a5a7e>打包出来的是umd格式的<code data-v-825a5a7e>H5SDK.js</code>.</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token comment" data-v-825a5a7e>// 正常</span>
<span class="token keyword" data-v-825a5a7e>import</span> <span class="token constant" data-v-825a5a7e>H5SDK</span> <span class="token keyword" data-v-825a5a7e>from</span> <span class="token string" data-v-825a5a7e>'../../src/index'</span>
<span class="token comment" data-v-825a5a7e>// 出错</span>
<span class="token keyword" data-v-825a5a7e>import</span> <span class="token constant" data-v-825a5a7e>H5SDK</span> <span class="token keyword" data-v-825a5a7e>from</span> <span class="token string" data-v-825a5a7e>'../../dist/H5SDK'</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>在example测试项目中，引用打包好的文件，竟然出错了</p> <p data-v-825a5a7e><img src="/font-docs/assets/img/21.456b1e56.png" alt="error" data-v-825a5a7e></p> <p data-v-825a5a7e><strong data-v-825a5a7e>原因</strong>：babel-loader 对 H5SDK.js 再次进行了编译</p> <p data-v-825a5a7e><strong data-v-825a5a7e>解决</strong>：</p> <ul data-v-825a5a7e><li data-v-825a5a7e>不建议：加了 &quot;@babel/plugin-transform-modules-umd&quot;, 插件就可以直接引本地的umd包</li> <li data-v-825a5a7e>babel-loader忽略对dist/H5SDK.js的编译</li></ul> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token punctuation" data-v-825a5a7e>{</span>
  test<span class="token operator" data-v-825a5a7e>:</span> <span class="token regex" data-v-825a5a7e><span class="token regex-delimiter" data-v-825a5a7e>/</span><span class="token regex-source language-regex" data-v-825a5a7e>\.(ts|js)x?$</span><span class="token regex-delimiter" data-v-825a5a7e>/</span></span><span class="token punctuation" data-v-825a5a7e>,</span>
  exclude<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>[</span>
    <span class="token regex" data-v-825a5a7e><span class="token regex-delimiter" data-v-825a5a7e>/</span><span class="token regex-source language-regex" data-v-825a5a7e>node_modules</span><span class="token regex-delimiter" data-v-825a5a7e>/</span></span><span class="token punctuation" data-v-825a5a7e>,</span>
    path<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span>__dirname<span class="token punctuation" data-v-825a5a7e>,</span> <span class="token string" data-v-825a5a7e>'../dist/H5SDK.js'</span><span class="token punctuation" data-v-825a5a7e>)</span>
  <span class="token punctuation" data-v-825a5a7e>]</span><span class="token punctuation" data-v-825a5a7e>,</span>
  use<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>{</span>
    loader<span class="token operator" data-v-825a5a7e>:</span> <span class="token string" data-v-825a5a7e>'babel-loader'</span><span class="token punctuation" data-v-825a5a7e>,</span>
    options<span class="token operator" data-v-825a5a7e>:</span> <span class="token punctuation" data-v-825a5a7e>{</span>
      configFile<span class="token operator" data-v-825a5a7e>:</span> path<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>resolve</span><span class="token punctuation" data-v-825a5a7e>(</span>__dirname<span class="token punctuation" data-v-825a5a7e>,</span> <span class="token string" data-v-825a5a7e>'babel.config.json'</span><span class="token punctuation" data-v-825a5a7e>)</span>
    <span class="token punctuation" data-v-825a5a7e>}</span>
  <span class="token punctuation" data-v-825a5a7e>}</span>
<span class="token punctuation" data-v-825a5a7e>}</span><span class="token punctuation" data-v-825a5a7e>,</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e></div></div><h2 id="部署" data-v-825a5a7e><a href="#部署" class="header-anchor" data-v-825a5a7e>#</a> 部署</h2> <ul data-v-825a5a7e><li data-v-825a5a7e>jenkins服务器
<ol data-v-825a5a7e><li data-v-825a5a7e>IP：172.16.253.221</li> <li data-v-825a5a7e>域名：jenkins.test.61info.com</li></ol></li> <li data-v-825a5a7e>业务服务器
<ol data-v-825a5a7e><li data-v-825a5a7e>IP: 172.16.51.4</li> <li data-v-825a5a7e>域名：draw-h5-test.61info.cn</li></ol></li></ul> <p data-v-825a5a7e>用新标签打开，查看大图：</p> <img src="/font-docs/assets/img/h5-sdk.a9524734.png" class="jenkins-img" data-v-825a5a7e> <h3 id="构建" data-v-825a5a7e><a href="#构建" class="header-anchor" data-v-825a5a7e>#</a> 构建</h3> <p data-v-825a5a7e><img src="/font-docs/assets/img/13.5f5809ce.png" alt="构建" data-v-825a5a7e></p> <p data-v-825a5a7e>在jenkins服务器中</p> <ol data-v-825a5a7e><li data-v-825a5a7e>jenkins会把<code data-v-825a5a7e>git</code>上的代码拉到<code data-v-825a5a7e>/home/data/jenkins/workspace/</code>目录</li> <li data-v-825a5a7e>执行<code data-v-825a5a7e>npm i</code>再执行打包命令<code data-v-825a5a7e>npm run</code>，最后把打包的dist内容压缩到web.zip压缩包。</li></ol> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token operator" data-v-825a5a7e>+</span> rm <span class="token operator" data-v-825a5a7e>-</span>f web<span class="token punctuation" data-v-825a5a7e>.</span>zip
<span class="token operator" data-v-825a5a7e>+</span> node <span class="token operator" data-v-825a5a7e>-</span>v
v12<span class="token punctuation" data-v-825a5a7e>.</span><span class="token number" data-v-825a5a7e>10.0</span>
<span class="token operator" data-v-825a5a7e>+</span> pwd
<span class="token operator" data-v-825a5a7e>/</span>home<span class="token operator" data-v-825a5a7e>/</span>data<span class="token operator" data-v-825a5a7e>/</span>jenkins<span class="token operator" data-v-825a5a7e>/</span>workspace<span class="token operator" data-v-825a5a7e>/</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk
<span class="token operator" data-v-825a5a7e>+</span> npm i
<span class="token operator" data-v-825a5a7e>+</span> npm run build<span class="token operator" data-v-825a5a7e>-</span>test

<span class="token operator" data-v-825a5a7e>&gt;</span> @i61<span class="token operator" data-v-825a5a7e>/</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk@<span class="token number" data-v-825a5a7e>1.1</span><span class="token number" data-v-825a5a7e>.0</span> build<span class="token operator" data-v-825a5a7e>-</span>test <span class="token operator" data-v-825a5a7e>/</span>home<span class="token operator" data-v-825a5a7e>/</span>data<span class="token operator" data-v-825a5a7e>/</span>jenkins<span class="token operator" data-v-825a5a7e>/</span>workspace<span class="token operator" data-v-825a5a7e>/</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk
<span class="token operator" data-v-825a5a7e>&gt;</span> webpack <span class="token operator" data-v-825a5a7e>--</span>mode<span class="token operator" data-v-825a5a7e>=</span>production <span class="token operator" data-v-825a5a7e>--</span>config <span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span>build<span class="token operator" data-v-825a5a7e>/</span>webpack<span class="token punctuation" data-v-825a5a7e>.</span>config<span class="token punctuation" data-v-825a5a7e>.</span>js

webpack <span class="token number" data-v-825a5a7e>5.54</span><span class="token number" data-v-825a5a7e>.0</span> compiled successfully <span class="token keyword" data-v-825a5a7e>in</span> <span class="token number" data-v-825a5a7e>10406</span> ms
<span class="token operator" data-v-825a5a7e>+</span> cd <span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span>dist
<span class="token operator" data-v-825a5a7e>+</span> zip <span class="token operator" data-v-825a5a7e>-</span>r <span class="token punctuation" data-v-825a5a7e>.</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span>web<span class="token punctuation" data-v-825a5a7e>.</span>zip <span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span>cc4578a99c34769a7e0fda7d9f11d457<span class="token punctuation" data-v-825a5a7e>.</span>png <span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span><span class="token constant" data-v-825a5a7e>H5SDK</span><span class="token punctuation" data-v-825a5a7e>.</span>js <span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span><span class="token keyword" data-v-825a5a7e>static</span>
  adding<span class="token operator" data-v-825a5a7e>:</span> cc4578a99c34769a7e0fda7d9f11d457<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>png</span> <span class="token punctuation" data-v-825a5a7e>(</span>stored <span class="token number" data-v-825a5a7e>0</span><span class="token operator" data-v-825a5a7e>%</span><span class="token punctuation" data-v-825a5a7e>)</span>
  adding<span class="token operator" data-v-825a5a7e>:</span> <span class="token constant" data-v-825a5a7e>H5SDK</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>js</span> <span class="token punctuation" data-v-825a5a7e>(</span>deflated <span class="token number" data-v-825a5a7e>67</span><span class="token operator" data-v-825a5a7e>%</span><span class="token punctuation" data-v-825a5a7e>)</span>
  adding<span class="token operator" data-v-825a5a7e>:</span> <span class="token keyword" data-v-825a5a7e>static</span><span class="token operator" data-v-825a5a7e>/</span> <span class="token punctuation" data-v-825a5a7e>(</span>stored <span class="token number" data-v-825a5a7e>0</span><span class="token operator" data-v-825a5a7e>%</span><span class="token punctuation" data-v-825a5a7e>)</span>
  adding<span class="token operator" data-v-825a5a7e>:</span> <span class="token keyword" data-v-825a5a7e>static</span><span class="token operator" data-v-825a5a7e>/</span>test<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>html</span> <span class="token punctuation" data-v-825a5a7e>(</span>deflated <span class="token number" data-v-825a5a7e>25</span><span class="token operator" data-v-825a5a7e>%</span><span class="token punctuation" data-v-825a5a7e>)</span>
  adding<span class="token operator" data-v-825a5a7e>:</span> <span class="token keyword" data-v-825a5a7e>static</span><span class="token operator" data-v-825a5a7e>/</span>wxTransfer<span class="token punctuation" data-v-825a5a7e>.</span><span class="token function" data-v-825a5a7e>html</span> <span class="token punctuation" data-v-825a5a7e>(</span>deflated <span class="token number" data-v-825a5a7e>52</span><span class="token operator" data-v-825a5a7e>%</span><span class="token punctuation" data-v-825a5a7e>)</span>
<span class="token operator" data-v-825a5a7e>+</span> cd <span class="token punctuation" data-v-825a5a7e>.</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span><span class="token punctuation" data-v-825a5a7e>.</span><span class="token punctuation" data-v-825a5a7e>.</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>构建后会更新web.zip</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token punctuation" data-v-825a5a7e>[</span>www@jenkins<span class="token operator" data-v-825a5a7e>-</span>test h5<span class="token operator" data-v-825a5a7e>-</span>sdk<span class="token punctuation" data-v-825a5a7e>]</span>$ ls
assets             dist     node_modules       <span class="token constant" data-v-825a5a7e>README</span><span class="token punctuation" data-v-825a5a7e>.</span>md  test           types
babel<span class="token punctuation" data-v-825a5a7e>.</span>config<span class="token punctuation" data-v-825a5a7e>.</span>json  docs     <span class="token keyword" data-v-825a5a7e>package</span><span class="token punctuation" data-v-825a5a7e>.</span>json       src        tsconfig<span class="token punctuation" data-v-825a5a7e>.</span>json  web<span class="token punctuation" data-v-825a5a7e>.</span>zip
build              example  <span class="token keyword" data-v-825a5a7e>package</span><span class="token operator" data-v-825a5a7e>-</span>lock<span class="token punctuation" data-v-825a5a7e>.</span>json  <span class="token keyword" data-v-825a5a7e>static</span>     typedoc<span class="token punctuation" data-v-825a5a7e>.</span>json
<span class="token punctuation" data-v-825a5a7e>[</span>www@jenkins<span class="token operator" data-v-825a5a7e>-</span>test h5<span class="token operator" data-v-825a5a7e>-</span>sdk<span class="token punctuation" data-v-825a5a7e>]</span>$ 
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e></div></div><h3 id="构建后操作" data-v-825a5a7e><a href="#构建后操作" class="header-anchor" data-v-825a5a7e>#</a> 构建后操作</h3> <p data-v-825a5a7e><img src="/font-docs/assets/img/14.6519d9d7.png" alt="构建后操作" data-v-825a5a7e></p> <p data-v-825a5a7e>连接业务服务器<code data-v-825a5a7e>172.16.51.4</code>，把jenkins服务器建构好的<code data-v-825a5a7e>web.zip</code>通过SSH推送到业务服务器的<code data-v-825a5a7e>/home/jenkins/deploy/h5-sdk/</code>目录</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token punctuation" data-v-825a5a7e>[</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk<span class="token punctuation" data-v-825a5a7e>]</span> $ <span class="token operator" data-v-825a5a7e>/</span>bin<span class="token operator" data-v-825a5a7e>/</span>sh <span class="token operator" data-v-825a5a7e>-</span>xe <span class="token operator" data-v-825a5a7e>/</span>tmp<span class="token operator" data-v-825a5a7e>/</span>jenkins4217326995803145882<span class="token punctuation" data-v-825a5a7e>.</span>sh
<span class="token operator" data-v-825a5a7e>+</span> project<span class="token operator" data-v-825a5a7e>=</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk
<span class="token operator" data-v-825a5a7e>+</span> <span class="token string" data-v-825a5a7e>'['</span> <span class="token number" data-v-825a5a7e>0</span> <span class="token operator" data-v-825a5a7e>-</span>eq <span class="token number" data-v-825a5a7e>1</span> <span class="token string" data-v-825a5a7e>']'</span>
<span class="token constant" data-v-825a5a7e>SSH</span><span class="token operator" data-v-825a5a7e>:</span> Connecting from host <span class="token punctuation" data-v-825a5a7e>[</span>jenkins<span class="token operator" data-v-825a5a7e>-</span>test<span class="token punctuation" data-v-825a5a7e>]</span>
<span class="token constant" data-v-825a5a7e>SSH</span><span class="token operator" data-v-825a5a7e>:</span> Connecting <span class="token keyword" data-v-825a5a7e>with</span> configuration <span class="token punctuation" data-v-825a5a7e>[</span>cms<span class="token operator" data-v-825a5a7e>-</span><span class="token number" data-v-825a5a7e>172.16</span><span class="token number" data-v-825a5a7e>.51</span><span class="token number" data-v-825a5a7e>.4</span><span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>...</span>
<span class="token constant" data-v-825a5a7e>SSH</span><span class="token operator" data-v-825a5a7e>:</span> <span class="token constant" data-v-825a5a7e>EXEC</span><span class="token operator" data-v-825a5a7e>:</span> completed after <span class="token number" data-v-825a5a7e>201</span> ms
<span class="token constant" data-v-825a5a7e>SSH</span><span class="token operator" data-v-825a5a7e>:</span> Disconnecting configuration <span class="token punctuation" data-v-825a5a7e>[</span>cms<span class="token operator" data-v-825a5a7e>-</span><span class="token number" data-v-825a5a7e>172.16</span><span class="token number" data-v-825a5a7e>.51</span><span class="token number" data-v-825a5a7e>.4</span><span class="token punctuation" data-v-825a5a7e>]</span> <span class="token operator" data-v-825a5a7e>...</span>
<span class="token constant" data-v-825a5a7e>SSH</span><span class="token operator" data-v-825a5a7e>:</span> Transferred <span class="token number" data-v-825a5a7e>1</span> <span class="token function" data-v-825a5a7e>file</span><span class="token punctuation" data-v-825a5a7e>(</span>s<span class="token punctuation" data-v-825a5a7e>)</span>
Finished<span class="token operator" data-v-825a5a7e>:</span> <span class="token constant" data-v-825a5a7e>SUCCESS</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>在业务服务器中，执行<code data-v-825a5a7e>deploy.sh脚本</code>，清空web目录内容，再把<code data-v-825a5a7e>web.zip</code>解压到<code data-v-825a5a7e>web目录</code></p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token punctuation" data-v-825a5a7e>[</span>www@localhost h5<span class="token operator" data-v-825a5a7e>-</span>sdk<span class="token punctuation" data-v-825a5a7e>]</span>$ cat deploy<span class="token punctuation" data-v-825a5a7e>.</span>sh
#<span class="token operator" data-v-825a5a7e>!</span> <span class="token operator" data-v-825a5a7e>/</span>bin<span class="token operator" data-v-825a5a7e>/</span>bash <span class="token operator" data-v-825a5a7e>-</span>e
rm <span class="token operator" data-v-825a5a7e>-</span>rf <span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span>web<span class="token comment" data-v-825a5a7e>/*
unzip web.zip -d ./web
</span></code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e></div></div><div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token punctuation" data-v-825a5a7e>[</span>www@localhost h5<span class="token operator" data-v-825a5a7e>-</span>sdk<span class="token punctuation" data-v-825a5a7e>]</span>$ pwd
<span class="token operator" data-v-825a5a7e>/</span>home<span class="token operator" data-v-825a5a7e>/</span>jenkins<span class="token operator" data-v-825a5a7e>/</span>deploy<span class="token operator" data-v-825a5a7e>/</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk
<span class="token punctuation" data-v-825a5a7e>[</span>www@localhost web<span class="token punctuation" data-v-825a5a7e>]</span>$ ls
cc4578a99c34769a7e0fda7d9f11d457<span class="token punctuation" data-v-825a5a7e>.</span>png  <span class="token constant" data-v-825a5a7e>H5SDK</span><span class="token punctuation" data-v-825a5a7e>.</span>js  <span class="token keyword" data-v-825a5a7e>static</span>
<span class="token punctuation" data-v-825a5a7e>[</span>www@localhost web<span class="token punctuation" data-v-825a5a7e>]</span>$ cd <span class="token punctuation" data-v-825a5a7e>.</span><span class="token punctuation" data-v-825a5a7e>.</span>
<span class="token punctuation" data-v-825a5a7e>[</span>www@localhost h5<span class="token operator" data-v-825a5a7e>-</span>sdk<span class="token punctuation" data-v-825a5a7e>]</span>$ ls
deploy<span class="token punctuation" data-v-825a5a7e>.</span>sh  web  web<span class="token punctuation" data-v-825a5a7e>.</span>zip
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e></div></div><h2 id="nginx配置" data-v-825a5a7e><a href="#nginx配置" class="header-anchor" data-v-825a5a7e>#</a> nginx配置</h2> <p data-v-825a5a7e><code data-v-825a5a7e>/usr/local/nginx/conf/vhost</code>目录下有各个业务的nginx配置，找到<code data-v-825a5a7e>activity-test.conf</code></p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token punctuation" data-v-825a5a7e>[</span>www@localhost vhost<span class="token punctuation" data-v-825a5a7e>]</span>$ pwd
<span class="token operator" data-v-825a5a7e>/</span>usr<span class="token operator" data-v-825a5a7e>/</span>local<span class="token operator" data-v-825a5a7e>/</span>nginx<span class="token operator" data-v-825a5a7e>/</span>conf<span class="token operator" data-v-825a5a7e>/</span>vhost
<span class="token punctuation" data-v-825a5a7e>[</span>www@localhost vhost<span class="token punctuation" data-v-825a5a7e>]</span>$ vim activity<span class="token operator" data-v-825a5a7e>-</span>test<span class="token punctuation" data-v-825a5a7e>.</span>conf 

<span class="token comment" data-v-825a5a7e>// activity-test.conf</span>
server <span class="token punctuation" data-v-825a5a7e>{</span>
  <span class="token comment" data-v-825a5a7e>// 支持http, https</span>
  listen   <span class="token number" data-v-825a5a7e>80</span><span class="token punctuation" data-v-825a5a7e>;</span>
  listen   <span class="token number" data-v-825a5a7e>443</span> ssl<span class="token punctuation" data-v-825a5a7e>;</span>
  <span class="token comment" data-v-825a5a7e>// 证书相关</span>
  ssl_certificate xxx<span class="token punctuation" data-v-825a5a7e>;</span>
  ssl_certificate_key xxxx<span class="token punctuation" data-v-825a5a7e>;</span>

  <span class="token comment" data-v-825a5a7e>// 域名</span>
  server_name  activity<span class="token operator" data-v-825a5a7e>-</span>test<span class="token punctuation" data-v-825a5a7e>.</span><span class="token number" data-v-825a5a7e>61</span>info<span class="token punctuation" data-v-825a5a7e>.</span>cn<span class="token punctuation" data-v-825a5a7e>;</span>
  access_log logs<span class="token operator" data-v-825a5a7e>/</span>activity<span class="token punctuation" data-v-825a5a7e>.</span>log<span class="token punctuation" data-v-825a5a7e>;</span>
  add_header Access<span class="token operator" data-v-825a5a7e>-</span>Control<span class="token operator" data-v-825a5a7e>-</span>Allow<span class="token operator" data-v-825a5a7e>-</span>Origin <span class="token operator" data-v-825a5a7e>*</span><span class="token punctuation" data-v-825a5a7e>;</span>
  add_header Access<span class="token operator" data-v-825a5a7e>-</span>Control<span class="token operator" data-v-825a5a7e>-</span>Allow<span class="token operator" data-v-825a5a7e>-</span>Methods <span class="token string" data-v-825a5a7e>'GET,POST'</span><span class="token punctuation" data-v-825a5a7e>;</span>
  add_header Access<span class="token operator" data-v-825a5a7e>-</span>Control<span class="token operator" data-v-825a5a7e>-</span>Allow<span class="token operator" data-v-825a5a7e>-</span>Headers <span class="token string" data-v-825a5a7e>'user-token,DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization'</span><span class="token punctuation" data-v-825a5a7e>;</span>

  index index<span class="token punctuation" data-v-825a5a7e>.</span>html<span class="token punctuation" data-v-825a5a7e>;</span>
  <span class="token comment" data-v-825a5a7e>// 添加了这条</span>
  location <span class="token operator" data-v-825a5a7e>/</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk <span class="token punctuation" data-v-825a5a7e>{</span>
    alias <span class="token operator" data-v-825a5a7e>/</span>home<span class="token operator" data-v-825a5a7e>/</span>jenkins<span class="token operator" data-v-825a5a7e>/</span>deploy<span class="token operator" data-v-825a5a7e>/</span>h5<span class="token operator" data-v-825a5a7e>-</span>sdk
  <span class="token punctuation" data-v-825a5a7e>}</span>
<span class="token punctuation" data-v-825a5a7e>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>6</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>7</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>8</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>9</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>10</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>11</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>12</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>13</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>14</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>15</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>16</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>17</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>18</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>19</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>20</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>21</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>22</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>23</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>24</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>25</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>26</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>执行<code data-v-825a5a7e>nginx -s reload</code>, 重启ngnix服务</p> <div class="language-js line-numbers-mode" data-v-825a5a7e><pre class="language-js" data-v-825a5a7e><code data-v-825a5a7e><span class="token punctuation" data-v-825a5a7e>[</span>www@localhost sbin<span class="token punctuation" data-v-825a5a7e>]</span>$ pwd
<span class="token operator" data-v-825a5a7e>/</span>usr<span class="token operator" data-v-825a5a7e>/</span>local<span class="token operator" data-v-825a5a7e>/</span>nginx<span class="token operator" data-v-825a5a7e>/</span>sbin
<span class="token punctuation" data-v-825a5a7e>[</span>www@localhost sbin<span class="token punctuation" data-v-825a5a7e>]</span>$ ls
<span class="token punctuation" data-v-825a5a7e>[</span>www@localhost sbin<span class="token punctuation" data-v-825a5a7e>]</span>$ nginx
<span class="token punctuation" data-v-825a5a7e>[</span>www@localhost sbin<span class="token punctuation" data-v-825a5a7e>]</span>$ <span class="token punctuation" data-v-825a5a7e>.</span><span class="token operator" data-v-825a5a7e>/</span>nginx <span class="token operator" data-v-825a5a7e>-</span>s reload
</code></pre> <div class="line-numbers-wrapper" data-v-825a5a7e><span class="line-number" data-v-825a5a7e>1</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>2</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>3</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>4</span><br data-v-825a5a7e><span class="line-number" data-v-825a5a7e>5</span><br data-v-825a5a7e></div></div><p data-v-825a5a7e>访问：<a href="https://activity-test.61info.cn/h5-sdk/static/test.html" target="_blank" rel="noopener noreferrer" data-v-825a5a7e>https://activity-test.61info.cn/h5-sdk/static/test.html<span data-v-825a5a7e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p data-v-825a5a7e><img src="data:image/png;base64,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" alt="test" data-v-825a5a7e></p> <h2 id="总结" data-v-825a5a7e><a href="#总结" class="header-anchor" data-v-825a5a7e>#</a> 总结</h2> <p data-v-825a5a7e>在开发H5时，遇到了重复对接APP SDK接口；微信分享重复开发；统一登陆Banner设计三大问题。我作为H5SDK开发者，把三大问题的解决方案appSdk, wxSdk, loginSdk集成到H5SDK，通过抛出Sdk构造函数，new实例化时在构造函数的原型添加相关函数，使H5SDK具有拓展性。统一登陆Sdk，满足app环境下双token登陆，微信环境下自动登陆，浏览器环境下帐密登陆，覆盖登陆三大场景。目前统一登陆已接入20+ 业务H5，大大提高了H5开发效率。</p> <p data-v-825a5a7e>参考：
<a href="https://juejin.cn/post/6844903988958068749" target="_blank" rel="noopener noreferrer" data-v-825a5a7e>babel-loader 对已编译的脚本进行再编译从而导致文件执行出错<span data-v-825a5a7e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/9/2021, 11:31:39 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/font-docs/project/H5/common-login-h5.html" class="prev">
        统一登陆
      </a></span> <span class="next"><a href="/font-docs/project/H5/h5-template.html">
        vue移动端多页面
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/font-docs/assets/js/app.ab113d22.js" defer></script><script src="/font-docs/assets/js/2.a7702232.js" defer></script><script src="/font-docs/assets/js/5.3099e729.js" defer></script>
  </body>
</html>
