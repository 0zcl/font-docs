<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基本使用 | 亮神前端小册</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="亮神前端小册">
    
    <link rel="preload" href="/font-docs/assets/css/0.styles.f8f07172.css" as="style"><link rel="preload" href="/font-docs/assets/js/app.ab113d22.js" as="script"><link rel="preload" href="/font-docs/assets/js/2.a7702232.js" as="script"><link rel="preload" href="/font-docs/assets/js/30.c9f6fdd6.js" as="script"><link rel="prefetch" href="/font-docs/assets/js/10.3d24c721.js"><link rel="prefetch" href="/font-docs/assets/js/100.b317c338.js"><link rel="prefetch" href="/font-docs/assets/js/101.b20aa33e.js"><link rel="prefetch" href="/font-docs/assets/js/102.b1f8d3b3.js"><link rel="prefetch" href="/font-docs/assets/js/103.ecb92d20.js"><link rel="prefetch" href="/font-docs/assets/js/104.59d1da3b.js"><link rel="prefetch" href="/font-docs/assets/js/105.b6bb704c.js"><link rel="prefetch" href="/font-docs/assets/js/106.32bea12f.js"><link rel="prefetch" href="/font-docs/assets/js/107.2a3c779a.js"><link rel="prefetch" href="/font-docs/assets/js/108.a28ed267.js"><link rel="prefetch" href="/font-docs/assets/js/109.e83bff13.js"><link rel="prefetch" href="/font-docs/assets/js/11.5bc93b46.js"><link rel="prefetch" href="/font-docs/assets/js/110.7fc996c2.js"><link rel="prefetch" href="/font-docs/assets/js/111.de0109d7.js"><link rel="prefetch" href="/font-docs/assets/js/112.85b9449c.js"><link rel="prefetch" href="/font-docs/assets/js/113.fc975125.js"><link rel="prefetch" href="/font-docs/assets/js/114.216bea7c.js"><link rel="prefetch" href="/font-docs/assets/js/115.090cfb62.js"><link rel="prefetch" href="/font-docs/assets/js/116.afa4d357.js"><link rel="prefetch" href="/font-docs/assets/js/117.914c90da.js"><link rel="prefetch" href="/font-docs/assets/js/118.36abb410.js"><link rel="prefetch" href="/font-docs/assets/js/119.d885fe45.js"><link rel="prefetch" href="/font-docs/assets/js/12.961a36e2.js"><link rel="prefetch" href="/font-docs/assets/js/120.54ed503a.js"><link rel="prefetch" href="/font-docs/assets/js/121.c3ea5174.js"><link rel="prefetch" href="/font-docs/assets/js/122.a623dd2a.js"><link rel="prefetch" href="/font-docs/assets/js/13.4c670e5e.js"><link rel="prefetch" href="/font-docs/assets/js/14.a1ce3775.js"><link rel="prefetch" href="/font-docs/assets/js/15.fa5a860a.js"><link rel="prefetch" href="/font-docs/assets/js/16.edacc258.js"><link rel="prefetch" href="/font-docs/assets/js/17.f8df7a8b.js"><link rel="prefetch" href="/font-docs/assets/js/18.72dcdd23.js"><link rel="prefetch" href="/font-docs/assets/js/19.706d6807.js"><link rel="prefetch" href="/font-docs/assets/js/20.108ddf67.js"><link rel="prefetch" href="/font-docs/assets/js/21.7da88a2a.js"><link rel="prefetch" href="/font-docs/assets/js/22.70a646e4.js"><link rel="prefetch" href="/font-docs/assets/js/23.c1c80ab4.js"><link rel="prefetch" href="/font-docs/assets/js/24.8be1409c.js"><link rel="prefetch" href="/font-docs/assets/js/25.dafa3760.js"><link rel="prefetch" href="/font-docs/assets/js/26.694e01e9.js"><link rel="prefetch" href="/font-docs/assets/js/27.039090e0.js"><link rel="prefetch" href="/font-docs/assets/js/28.0c94be50.js"><link rel="prefetch" href="/font-docs/assets/js/29.c32e555d.js"><link rel="prefetch" href="/font-docs/assets/js/3.c0d26cb5.js"><link rel="prefetch" href="/font-docs/assets/js/31.bcbaf1a9.js"><link rel="prefetch" href="/font-docs/assets/js/32.36213dc7.js"><link rel="prefetch" href="/font-docs/assets/js/33.f7c8afde.js"><link rel="prefetch" href="/font-docs/assets/js/34.e834e023.js"><link rel="prefetch" href="/font-docs/assets/js/35.8dda312f.js"><link rel="prefetch" href="/font-docs/assets/js/36.11df78b4.js"><link rel="prefetch" href="/font-docs/assets/js/37.15a9a489.js"><link rel="prefetch" href="/font-docs/assets/js/38.cec81ca8.js"><link rel="prefetch" href="/font-docs/assets/js/39.8ddef536.js"><link rel="prefetch" href="/font-docs/assets/js/4.ea27e4cd.js"><link rel="prefetch" href="/font-docs/assets/js/40.193534f1.js"><link rel="prefetch" href="/font-docs/assets/js/41.ce1b23e7.js"><link rel="prefetch" href="/font-docs/assets/js/42.11994eef.js"><link rel="prefetch" href="/font-docs/assets/js/43.1120971d.js"><link rel="prefetch" href="/font-docs/assets/js/44.e70be40e.js"><link rel="prefetch" href="/font-docs/assets/js/45.f32091eb.js"><link rel="prefetch" href="/font-docs/assets/js/46.0470b16d.js"><link rel="prefetch" href="/font-docs/assets/js/47.f8af876b.js"><link rel="prefetch" href="/font-docs/assets/js/48.ce448fc0.js"><link rel="prefetch" href="/font-docs/assets/js/49.3c9aa3b6.js"><link rel="prefetch" href="/font-docs/assets/js/5.3099e729.js"><link rel="prefetch" href="/font-docs/assets/js/50.0247cc44.js"><link rel="prefetch" href="/font-docs/assets/js/51.edaf96f4.js"><link rel="prefetch" href="/font-docs/assets/js/52.bac5c38d.js"><link rel="prefetch" href="/font-docs/assets/js/53.9a769cc8.js"><link rel="prefetch" href="/font-docs/assets/js/54.755585b1.js"><link rel="prefetch" href="/font-docs/assets/js/55.0c0d8035.js"><link rel="prefetch" href="/font-docs/assets/js/56.906e3715.js"><link rel="prefetch" href="/font-docs/assets/js/57.6d39b791.js"><link rel="prefetch" href="/font-docs/assets/js/58.e39d5548.js"><link rel="prefetch" href="/font-docs/assets/js/59.9a4436d4.js"><link rel="prefetch" href="/font-docs/assets/js/6.fa3b5319.js"><link rel="prefetch" href="/font-docs/assets/js/60.db97d3d4.js"><link rel="prefetch" href="/font-docs/assets/js/61.63ebb788.js"><link rel="prefetch" href="/font-docs/assets/js/62.2e1642b4.js"><link rel="prefetch" href="/font-docs/assets/js/63.404afa47.js"><link rel="prefetch" href="/font-docs/assets/js/64.3fc9bd1a.js"><link rel="prefetch" href="/font-docs/assets/js/65.087359aa.js"><link rel="prefetch" href="/font-docs/assets/js/66.0e1dbfa1.js"><link rel="prefetch" href="/font-docs/assets/js/67.f5508703.js"><link rel="prefetch" href="/font-docs/assets/js/68.063a4309.js"><link rel="prefetch" href="/font-docs/assets/js/69.e003c953.js"><link rel="prefetch" href="/font-docs/assets/js/7.8f66f4e3.js"><link rel="prefetch" href="/font-docs/assets/js/70.db533f79.js"><link rel="prefetch" href="/font-docs/assets/js/71.f5adc2fe.js"><link rel="prefetch" href="/font-docs/assets/js/72.c77d8ceb.js"><link rel="prefetch" href="/font-docs/assets/js/73.53bb4c8a.js"><link rel="prefetch" href="/font-docs/assets/js/74.fa982014.js"><link rel="prefetch" href="/font-docs/assets/js/75.ebc912b8.js"><link rel="prefetch" href="/font-docs/assets/js/76.360b896f.js"><link rel="prefetch" href="/font-docs/assets/js/77.09e34fb3.js"><link rel="prefetch" href="/font-docs/assets/js/78.e51a0adc.js"><link rel="prefetch" href="/font-docs/assets/js/79.0d18c5fd.js"><link rel="prefetch" href="/font-docs/assets/js/8.91fc3f7b.js"><link rel="prefetch" href="/font-docs/assets/js/80.19046804.js"><link rel="prefetch" href="/font-docs/assets/js/81.86b61c9b.js"><link rel="prefetch" href="/font-docs/assets/js/82.e3b85ba1.js"><link rel="prefetch" href="/font-docs/assets/js/83.2e228169.js"><link rel="prefetch" href="/font-docs/assets/js/84.3c6de565.js"><link rel="prefetch" href="/font-docs/assets/js/85.195aa246.js"><link rel="prefetch" href="/font-docs/assets/js/86.9592c42a.js"><link rel="prefetch" href="/font-docs/assets/js/87.4f35105c.js"><link rel="prefetch" href="/font-docs/assets/js/88.3eb20e04.js"><link rel="prefetch" href="/font-docs/assets/js/89.aa1241cf.js"><link rel="prefetch" href="/font-docs/assets/js/9.c2c6aed5.js"><link rel="prefetch" href="/font-docs/assets/js/90.097b16ac.js"><link rel="prefetch" href="/font-docs/assets/js/91.bcc1349e.js"><link rel="prefetch" href="/font-docs/assets/js/92.3b8c2727.js"><link rel="prefetch" href="/font-docs/assets/js/93.2ef6a5d8.js"><link rel="prefetch" href="/font-docs/assets/js/94.5d8072d4.js"><link rel="prefetch" href="/font-docs/assets/js/95.7e6d60ea.js"><link rel="prefetch" href="/font-docs/assets/js/96.2f7249dc.js"><link rel="prefetch" href="/font-docs/assets/js/97.bc860a09.js"><link rel="prefetch" href="/font-docs/assets/js/98.c48a9f29.js"><link rel="prefetch" href="/font-docs/assets/js/99.7f628413.js">
    <link rel="stylesheet" href="/font-docs/assets/css/0.styles.f8f07172.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/font-docs/" class="home-link router-link-active"><!----> <span class="site-name">亮神前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/font-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/font-docs/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/font-docs/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/font-docs/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/font-docs/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/font-docs/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/font-docs/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/font-docs/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/compiler/" class="nav-link router-link-active">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/font-docs/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/font-docs/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/font-docs/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/font-docs/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/0zcl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/font-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/font-docs/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/font-docs/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/font-docs/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/font-docs/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/font-docs/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/font-docs/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/font-docs/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/compiler/" class="nav-link router-link-active">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/font-docs/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/font-docs/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/font-docs/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/font-docs/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/0zcl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>模版编译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/font-docs/vue/compiler/" class="sidebar-heading clickable router-link-active open"><span>模版编译</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/font-docs/vue/compiler/" aria-current="page" class="sidebar-link">模板编译</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/#模板编译" class="sidebar-link">模板编译</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/#vue模板渲染的原理是什么" class="sidebar-link">Vue模板渲染的原理是什么？</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/#标记静态节点" class="sidebar-link">标记静态节点</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/#静态节点类型" class="sidebar-link">静态节点类型</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/#标记静态根节点" class="sidebar-link">标记静态根节点</a></li></ul></li><li><a href="/font-docs/vue/compiler/slot.html" class="sidebar-link">插槽</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/slot.html#slot是什么" class="sidebar-link">slot是什么？</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/slot.html#有什么作用" class="sidebar-link">有什么作用？</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/slot.html#默认插槽" class="sidebar-link">默认插槽</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/slot.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/slot.html#作用域插槽" class="sidebar-link">作用域插槽</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/slot.html#总结-2" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/slot.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/font-docs/vue/compiler/keep-alive.html" aria-current="page" class="active sidebar-link">keep-alive</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/keep-alive.html#基本使用" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/keep-alive.html#结合vue-router" class="sidebar-link">结合vue-router</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/keep-alive.html#lru策略" class="sidebar-link">LRU策略</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/keep-alive.html#源码解析" class="sidebar-link">源码解析</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/keep-alive.html#keep-alive组件渲染" class="sidebar-link">keep-alive组件渲染</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/keep-alive.html#keep-alive组件渲染过程" class="sidebar-link">keep-alive组件渲染过程</a></li><li class="sidebar-sub-header"><a href="/font-docs/vue/compiler/keep-alive.html#面试" class="sidebar-link">面试</a></li></ul></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default" data-v-533ddd3c data-v-533ddd3c><h2 id="基本使用" data-v-533ddd3c><a href="#基本使用" class="header-anchor" data-v-533ddd3c>#</a> 基本使用</h2> <p data-v-533ddd3c>keep-alive 是 Vue 内置的一个组件，可以使被包含的组件保留状态，或避免重新渲染。</p> <p data-v-533ddd3c>keep-alive 新加入了两个属性: include(包含的组件缓存生效) 与 exclude(排除的组件不缓存)</p> <p data-v-533ddd3c>include 和 exclude 属性允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示</p> <div class="language-html line-numbers-mode" data-v-533ddd3c><pre class="language-html" data-v-533ddd3c><code data-v-533ddd3c><span class="token comment" data-v-533ddd3c>&lt;!-- 逗号分隔字符串，只有组件a与b被缓存 --&gt;</span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-533ddd3c>include</span><span class="token attr-value" data-v-533ddd3c><span class="token punctuation attr-equals" data-v-533ddd3c>=</span><span class="token punctuation" data-v-533ddd3c>&quot;</span>a,b<span class="token punctuation" data-v-533ddd3c>&quot;</span></span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
  <span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>component</span> <span class="token attr-name" data-v-533ddd3c>:is</span><span class="token attr-value" data-v-533ddd3c><span class="token punctuation attr-equals" data-v-533ddd3c>=</span><span class="token punctuation" data-v-533ddd3c>&quot;</span>view<span class="token punctuation" data-v-533ddd3c>&quot;</span></span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span><span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>component</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token comment" data-v-533ddd3c>&lt;!-- 正则表达式 --&gt;</span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-533ddd3c>:include</span><span class="token attr-value" data-v-533ddd3c><span class="token punctuation attr-equals" data-v-533ddd3c>=</span><span class="token punctuation" data-v-533ddd3c>&quot;</span>/a|b/<span class="token punctuation" data-v-533ddd3c>&quot;</span></span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
  <span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>component</span> <span class="token attr-name" data-v-533ddd3c>:is</span><span class="token attr-value" data-v-533ddd3c><span class="token punctuation attr-equals" data-v-533ddd3c>=</span><span class="token punctuation" data-v-533ddd3c>&quot;</span>view<span class="token punctuation" data-v-533ddd3c>&quot;</span></span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span><span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>component</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token comment" data-v-533ddd3c>&lt;!-- Array --&gt;</span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-533ddd3c>:include</span><span class="token attr-value" data-v-533ddd3c><span class="token punctuation attr-equals" data-v-533ddd3c>=</span><span class="token punctuation" data-v-533ddd3c>&quot;</span>[<span class="token punctuation" data-v-533ddd3c>'</span>a<span class="token punctuation" data-v-533ddd3c>'</span>, <span class="token punctuation" data-v-533ddd3c>'</span>b<span class="token punctuation" data-v-533ddd3c>'</span>]<span class="token punctuation" data-v-533ddd3c>&quot;</span></span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
  <span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>component</span> <span class="token attr-name" data-v-533ddd3c>:is</span><span class="token attr-value" data-v-533ddd3c><span class="token punctuation attr-equals" data-v-533ddd3c>=</span><span class="token punctuation" data-v-533ddd3c>&quot;</span>view<span class="token punctuation" data-v-533ddd3c>&quot;</span></span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span><span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>component</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>12</span><br data-v-533ddd3c></div></div><h3 id="生命周期钩子" data-v-533ddd3c><a href="#生命周期钩子" class="header-anchor" data-v-533ddd3c>#</a> 生命周期钩子</h3> <p data-v-533ddd3c>被包含在 <code data-v-533ddd3c>&lt;keep-alive&gt;</code> 中创建的组件，会多出两个生命周期的钩子: activated 与 deactivated</p> <ul data-v-533ddd3c><li data-v-533ddd3c>activated: 在组件被激活时调用，在组件第一次渲染时也会被调用，之后每次keep-alive激活时被调用。</li> <li data-v-533ddd3c>deactivated: 在组件被停用时调用。</li> <li data-v-533ddd3c>首次进入组件时：beforeRouteEnter &gt; beforeCreate &gt; created&gt; mounted &gt; activated &gt; ... ... &gt; beforeRouteLeave &gt; deactivated</li> <li data-v-533ddd3c>再次进入组件时：beforeRouteEnter &gt;activated &gt; ... ... &gt; beforeRouteLeave &gt; deactivated</li></ul> <p data-v-533ddd3c>注意：</p> <div class="custom-block tip" data-v-533ddd3c><p class="custom-block-title" data-v-533ddd3c>Tips</p> <p data-v-533ddd3c>当组件在 <code data-v-533ddd3c>&lt;keep-alive&gt;</code> 内被切换，<code data-v-533ddd3c>activated</code> 和 <code data-v-533ddd3c>deactivated</code> 这两个生命周期才会被调用</p> <p data-v-533ddd3c>在服务端渲染时此钩子也不会被调用的</p></div> <h2 id="结合vue-router" data-v-533ddd3c><a href="#结合vue-router" class="header-anchor" data-v-533ddd3c>#</a> 结合vue-router</h2> <p data-v-533ddd3c>router-view 也是一个组件，如果直接被包在 keep-alive 里面，所有路径匹配到的视图组件都会被缓存。</p> <div class="language-html line-numbers-mode" data-v-533ddd3c><pre class="language-html" data-v-533ddd3c><code data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>keep-alive</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
  <span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>router-view</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
    <span class="token comment" data-v-533ddd3c>&lt;!-- 所有路径匹配到的视图组件都会被缓存！ --&gt;</span>
  <span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>router-view</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c></div></div><h2 id="lru策略" data-v-533ddd3c><a href="#lru策略" class="header-anchor" data-v-533ddd3c>#</a> LRU策略</h2> <p data-v-533ddd3c>在使用 keep-alive 时，可以添加 prop 属性 include、exclude、max 允许组件有条件的缓存。既然有限制条件，旧的组件需要删除缓存，新的组件就需要加入到最新缓存，那么要如何制定对应的策略？</p> <p data-v-533ddd3c>LRU（Least recently used，最近最少使用）策略根据数据的历史访问记录来进行淘汰数据。LRU 策略的设计原则是，如果一个数据在最近一段时间没有被访问到，那么在将来它被访问的可能性也很小。也就是说，<code data-v-533ddd3c>当限定的空间已存满数据时，应当把最久没有被访问到的数据淘汰</code></p> <p data-v-533ddd3c><img src="/font-docs/assets/img/5.998b52e7.png" alt="LRU" data-v-533ddd3c></p> <p data-v-533ddd3c><code data-v-533ddd3c>keep-alive</code> 缓存机制便是根据LRU策略来设置缓存组件新鲜度，将很久未访问的组件从缓存中删除</p> <h2 id="源码解析" data-v-533ddd3c><a href="#源码解析" class="header-anchor" data-v-533ddd3c>#</a> 源码解析</h2> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token keyword" data-v-533ddd3c>export</span> <span class="token keyword" data-v-533ddd3c>default</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  name<span class="token operator" data-v-533ddd3c>:</span> <span class="token string" data-v-533ddd3c>'keep-alive'</span><span class="token punctuation" data-v-533ddd3c>,</span>
  abstract<span class="token operator" data-v-533ddd3c>:</span> <span class="token boolean" data-v-533ddd3c>true</span><span class="token punctuation" data-v-533ddd3c>,</span>

  props<span class="token operator" data-v-533ddd3c>:</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    include<span class="token operator" data-v-533ddd3c>:</span> patternTypes<span class="token punctuation" data-v-533ddd3c>,</span>
    exclude<span class="token operator" data-v-533ddd3c>:</span> patternTypes<span class="token punctuation" data-v-533ddd3c>,</span>
    max<span class="token operator" data-v-533ddd3c>:</span> <span class="token punctuation" data-v-533ddd3c>[</span>String<span class="token punctuation" data-v-533ddd3c>,</span> Number<span class="token punctuation" data-v-533ddd3c>]</span>
  <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>

  <span class="token function" data-v-533ddd3c>created</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>cache <span class="token operator" data-v-533ddd3c>=</span> Object<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>create</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token keyword" data-v-533ddd3c>null</span><span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>keys <span class="token operator" data-v-533ddd3c>=</span> <span class="token punctuation" data-v-533ddd3c>[</span><span class="token punctuation" data-v-533ddd3c>]</span>
  <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>

  <span class="token function" data-v-533ddd3c>destroyed</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>for</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token keyword" data-v-533ddd3c>const</span> key <span class="token keyword" data-v-533ddd3c>in</span> <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>cache<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token function" data-v-533ddd3c>pruneCacheEntry</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>cache<span class="token punctuation" data-v-533ddd3c>,</span> key<span class="token punctuation" data-v-533ddd3c>,</span> <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>keys<span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token punctuation" data-v-533ddd3c>}</span>
  <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>

  <span class="token function" data-v-533ddd3c>mounted</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>$watch</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token string" data-v-533ddd3c>'include'</span><span class="token punctuation" data-v-533ddd3c>,</span> <span class="token parameter" data-v-533ddd3c>val</span> <span class="token operator" data-v-533ddd3c>=&gt;</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token function" data-v-533ddd3c>pruneCache</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>,</span> <span class="token parameter" data-v-533ddd3c>name</span> <span class="token operator" data-v-533ddd3c>=&gt;</span> <span class="token function" data-v-533ddd3c>matches</span><span class="token punctuation" data-v-533ddd3c>(</span>val<span class="token punctuation" data-v-533ddd3c>,</span> name<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>$watch</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token string" data-v-533ddd3c>'exclude'</span><span class="token punctuation" data-v-533ddd3c>,</span> <span class="token parameter" data-v-533ddd3c>val</span> <span class="token operator" data-v-533ddd3c>=&gt;</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token function" data-v-533ddd3c>pruneCache</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>,</span> <span class="token parameter" data-v-533ddd3c>name</span> <span class="token operator" data-v-533ddd3c>=&gt;</span> <span class="token operator" data-v-533ddd3c>!</span><span class="token function" data-v-533ddd3c>matches</span><span class="token punctuation" data-v-533ddd3c>(</span>val<span class="token punctuation" data-v-533ddd3c>,</span> name<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>)</span>
  <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>

  <span class="token function" data-v-533ddd3c>render</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>const</span> slot <span class="token operator" data-v-533ddd3c>=</span> <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>$slots<span class="token punctuation" data-v-533ddd3c>.</span>default
    <span class="token comment" data-v-533ddd3c>// 找到第一个子组件对象</span>
    <span class="token keyword" data-v-533ddd3c>const</span> vnode<span class="token operator" data-v-533ddd3c>:</span> VNode <span class="token operator" data-v-533ddd3c>=</span> <span class="token function" data-v-533ddd3c>getFirstComponentChild</span><span class="token punctuation" data-v-533ddd3c>(</span>slot<span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token keyword" data-v-533ddd3c>const</span> componentOptions<span class="token operator" data-v-533ddd3c>:</span> <span class="token operator" data-v-533ddd3c>?</span>VNodeComponentOptions <span class="token operator" data-v-533ddd3c>=</span> vnode <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> vnode<span class="token punctuation" data-v-533ddd3c>.</span>componentOptions
    <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>componentOptions<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token comment" data-v-533ddd3c>// 组件名</span>
      <span class="token keyword" data-v-533ddd3c>const</span> name<span class="token operator" data-v-533ddd3c>:</span> <span class="token operator" data-v-533ddd3c>?</span>string <span class="token operator" data-v-533ddd3c>=</span> <span class="token function" data-v-533ddd3c>getComponentName</span><span class="token punctuation" data-v-533ddd3c>(</span>componentOptions<span class="token punctuation" data-v-533ddd3c>)</span>
      <span class="token keyword" data-v-533ddd3c>const</span> <span class="token punctuation" data-v-533ddd3c>{</span> include<span class="token punctuation" data-v-533ddd3c>,</span> exclude <span class="token punctuation" data-v-533ddd3c>}</span> <span class="token operator" data-v-533ddd3c>=</span> <span class="token keyword" data-v-533ddd3c>this</span>
      <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>
        <span class="token comment" data-v-533ddd3c>// not included</span>
        <span class="token punctuation" data-v-533ddd3c>(</span>include <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token operator" data-v-533ddd3c>!</span>name <span class="token operator" data-v-533ddd3c>||</span> <span class="token operator" data-v-533ddd3c>!</span><span class="token function" data-v-533ddd3c>matches</span><span class="token punctuation" data-v-533ddd3c>(</span>include<span class="token punctuation" data-v-533ddd3c>,</span> name<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token operator" data-v-533ddd3c>||</span>
        <span class="token comment" data-v-533ddd3c>// excluded</span>
        <span class="token punctuation" data-v-533ddd3c>(</span>exclude <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> name <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> <span class="token function" data-v-533ddd3c>matches</span><span class="token punctuation" data-v-533ddd3c>(</span>exclude<span class="token punctuation" data-v-533ddd3c>,</span> name<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span>
      <span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
        <span class="token keyword" data-v-533ddd3c>return</span> vnode
      <span class="token punctuation" data-v-533ddd3c>}</span>
      <span class="token keyword" data-v-533ddd3c>const</span> <span class="token punctuation" data-v-533ddd3c>{</span> cache<span class="token punctuation" data-v-533ddd3c>,</span> keys <span class="token punctuation" data-v-533ddd3c>}</span> <span class="token operator" data-v-533ddd3c>=</span> <span class="token keyword" data-v-533ddd3c>this</span>
      <span class="token comment" data-v-533ddd3c>// 定义组件的缓存key. 如果vnode没有key，则根据组件ID和tag生成缓存Key</span>
      <span class="token keyword" data-v-533ddd3c>const</span> key<span class="token operator" data-v-533ddd3c>:</span> <span class="token operator" data-v-533ddd3c>?</span>string <span class="token operator" data-v-533ddd3c>=</span> vnode<span class="token punctuation" data-v-533ddd3c>.</span>key <span class="token operator" data-v-533ddd3c>==</span> <span class="token keyword" data-v-533ddd3c>null</span>
        <span class="token operator" data-v-533ddd3c>?</span> componentOptions<span class="token punctuation" data-v-533ddd3c>.</span>Ctor<span class="token punctuation" data-v-533ddd3c>.</span>cid <span class="token operator" data-v-533ddd3c>+</span> <span class="token punctuation" data-v-533ddd3c>(</span>componentOptions<span class="token punctuation" data-v-533ddd3c>.</span>tag <span class="token operator" data-v-533ddd3c>?</span> <span class="token template-string" data-v-533ddd3c><span class="token template-punctuation string" data-v-533ddd3c>`</span><span class="token string" data-v-533ddd3c>::</span><span class="token interpolation" data-v-533ddd3c><span class="token interpolation-punctuation punctuation" data-v-533ddd3c>${</span>componentOptions<span class="token punctuation" data-v-533ddd3c>.</span>tag<span class="token interpolation-punctuation punctuation" data-v-533ddd3c>}</span></span><span class="token template-punctuation string" data-v-533ddd3c>`</span></span> <span class="token operator" data-v-533ddd3c>:</span> <span class="token string" data-v-533ddd3c>''</span><span class="token punctuation" data-v-533ddd3c>)</span>
        <span class="token operator" data-v-533ddd3c>:</span> vnode<span class="token punctuation" data-v-533ddd3c>.</span>key
      <span class="token comment" data-v-533ddd3c>// 已经缓存过该组件</span>
      <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>cache<span class="token punctuation" data-v-533ddd3c>[</span>key<span class="token punctuation" data-v-533ddd3c>]</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
        vnode<span class="token punctuation" data-v-533ddd3c>.</span>componentInstance <span class="token operator" data-v-533ddd3c>=</span> cache<span class="token punctuation" data-v-533ddd3c>[</span>key<span class="token punctuation" data-v-533ddd3c>]</span><span class="token punctuation" data-v-533ddd3c>.</span>componentInstance
        <span class="token comment" data-v-533ddd3c>// make current key freshest</span>
        <span class="token function" data-v-533ddd3c>remove</span><span class="token punctuation" data-v-533ddd3c>(</span>keys<span class="token punctuation" data-v-533ddd3c>,</span> key<span class="token punctuation" data-v-533ddd3c>)</span>
        keys<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>push</span><span class="token punctuation" data-v-533ddd3c>(</span>key<span class="token punctuation" data-v-533ddd3c>)</span>
      <span class="token punctuation" data-v-533ddd3c>}</span> <span class="token keyword" data-v-533ddd3c>else</span> <span class="token punctuation" data-v-533ddd3c>{</span>
        cache<span class="token punctuation" data-v-533ddd3c>[</span>key<span class="token punctuation" data-v-533ddd3c>]</span> <span class="token operator" data-v-533ddd3c>=</span> vnode <span class="token comment" data-v-533ddd3c>// 缓存组件对象</span>
        keys<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>push</span><span class="token punctuation" data-v-533ddd3c>(</span>key<span class="token punctuation" data-v-533ddd3c>)</span>
        <span class="token comment" data-v-533ddd3c>// 超过缓存数限制，将第一个删除</span>
        <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>max <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> keys<span class="token punctuation" data-v-533ddd3c>.</span>length <span class="token operator" data-v-533ddd3c>&gt;</span> <span class="token function" data-v-533ddd3c>parseInt</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>max<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
          <span class="token function" data-v-533ddd3c>pruneCacheEntry</span><span class="token punctuation" data-v-533ddd3c>(</span>cache<span class="token punctuation" data-v-533ddd3c>,</span> keys<span class="token punctuation" data-v-533ddd3c>[</span><span class="token number" data-v-533ddd3c>0</span><span class="token punctuation" data-v-533ddd3c>]</span><span class="token punctuation" data-v-533ddd3c>,</span> keys<span class="token punctuation" data-v-533ddd3c>,</span> <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>_vnode<span class="token punctuation" data-v-533ddd3c>)</span>
        <span class="token punctuation" data-v-533ddd3c>}</span>
      <span class="token punctuation" data-v-533ddd3c>}</span>
      <span class="token comment" data-v-533ddd3c>// 将该组件实例的keepAlive属性值设置为true</span>
      vnode<span class="token punctuation" data-v-533ddd3c>.</span>data<span class="token punctuation" data-v-533ddd3c>.</span>keepAlive <span class="token operator" data-v-533ddd3c>=</span> <span class="token boolean" data-v-533ddd3c>true</span>
    <span class="token punctuation" data-v-533ddd3c>}</span>
    <span class="token keyword" data-v-533ddd3c>return</span> vnode <span class="token operator" data-v-533ddd3c>||</span> <span class="token punctuation" data-v-533ddd3c>(</span>slot <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> slot<span class="token punctuation" data-v-533ddd3c>[</span><span class="token number" data-v-533ddd3c>0</span><span class="token punctuation" data-v-533ddd3c>]</span><span class="token punctuation" data-v-533ddd3c>)</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>12</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>13</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>14</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>15</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>16</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>17</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>18</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>19</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>20</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>21</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>22</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>23</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>24</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>25</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>26</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>27</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>28</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>29</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>30</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>31</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>32</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>33</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>34</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>35</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>36</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>37</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>38</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>39</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>40</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>41</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>42</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>43</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>44</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>45</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>46</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>47</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>48</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>49</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>50</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>51</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>52</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>53</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>54</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>55</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>56</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>57</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>58</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>59</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>60</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>61</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>62</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>63</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>64</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>65</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>66</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>67</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>68</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>69</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>70</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>71</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>72</span><br data-v-533ddd3c></div></div><ul data-v-533ddd3c><li data-v-533ddd3c>组件缓存key放入<code data-v-533ddd3c>this.keys</code>数组中。根据LRU策略，如果组件未缓存过，则直接push；若已缓存过，则先把keys数据中缓存的组件key删除，再push组件缓存key</li> <li data-v-533ddd3c><code data-v-533ddd3c>this.cache</code>对象中存储该组件实例并保存key值</li> <li data-v-533ddd3c>检查缓存的实例数量是否超过max的设置值，超过则根据LRU策略删除最近最久未使用的实例（即是下标为0的那个key）</li> <li data-v-533ddd3c>将该组件实例的<code data-v-533ddd3c>keepAlive</code>属性值设置为true</li></ul> <p data-v-533ddd3c>以上，是keep-alive的源码。简洁明了。</p> <h2 id="keep-alive组件渲染" data-v-533ddd3c><a href="#keep-alive组件渲染" class="header-anchor" data-v-533ddd3c>#</a> keep-alive组件渲染</h2> <p data-v-533ddd3c><strong data-v-533ddd3c>keep-alive 它不会生成真正的DOM节点，这是怎么做到的？</strong></p> <p data-v-533ddd3c>kepp-alive 实际是一个<code data-v-533ddd3c>抽象组件</code>，只对包裹的子组件做处理，并不会和子组件建立父子关系，也不会作为节点渲染到页面上。在组件开头就设置 <code data-v-533ddd3c>abstract</code> 为 true，代表该组件是一个抽象组件。</p> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token comment" data-v-533ddd3c>// 源码位置： src/core/instance/lifecycle.js</span>
<span class="token keyword" data-v-533ddd3c>export</span> <span class="token keyword" data-v-533ddd3c>function</span> <span class="token function" data-v-533ddd3c>initLifecycle</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token parameter" data-v-533ddd3c>vm<span class="token operator" data-v-533ddd3c>:</span> Component</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token keyword" data-v-533ddd3c>const</span> options <span class="token operator" data-v-533ddd3c>=</span> vm<span class="token punctuation" data-v-533ddd3c>.</span>$options
  <span class="token comment" data-v-533ddd3c>// 找到第一个非abstract的父组件实例</span>
  <span class="token keyword" data-v-533ddd3c>let</span> parent <span class="token operator" data-v-533ddd3c>=</span> options<span class="token punctuation" data-v-533ddd3c>.</span>parent
  <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>parent <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> <span class="token operator" data-v-533ddd3c>!</span>options<span class="token punctuation" data-v-533ddd3c>.</span>abstract<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>while</span> <span class="token punctuation" data-v-533ddd3c>(</span>parent<span class="token punctuation" data-v-533ddd3c>.</span>$options<span class="token punctuation" data-v-533ddd3c>.</span>abstract <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> parent<span class="token punctuation" data-v-533ddd3c>.</span>$parent<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      parent <span class="token operator" data-v-533ddd3c>=</span> parent<span class="token punctuation" data-v-533ddd3c>.</span>$parent
    <span class="token punctuation" data-v-533ddd3c>}</span>
    parent<span class="token punctuation" data-v-533ddd3c>.</span>$children<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>push</span><span class="token punctuation" data-v-533ddd3c>(</span>vm<span class="token punctuation" data-v-533ddd3c>)</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
  vm<span class="token punctuation" data-v-533ddd3c>.</span>$parent <span class="token operator" data-v-533ddd3c>=</span> parent
  <span class="token comment" data-v-533ddd3c>// ...</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>12</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>13</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>14</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>在初始化阶段会调用 initLifecycle，里面判断父级是否为抽象组件，如果是抽象组件，就选取抽象组件的上一级作为父级，忽略与抽象组件和子组件之间的层级关系。</p> <p data-v-533ddd3c>最后构建的组件树中就不会包含keep-alive组件，那么由组件树渲染成的DOM树自然也不会有keep-alive相关的节点了。</p> <p data-v-533ddd3c>回到keep-alive组件，看看渲染keep-alive组件做了啥。
keep-alive组件由 <code data-v-533ddd3c>render 函数</code>决定渲染结果</p> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token keyword" data-v-533ddd3c>const</span> slot <span class="token operator" data-v-533ddd3c>=</span> <span class="token keyword" data-v-533ddd3c>this</span><span class="token punctuation" data-v-533ddd3c>.</span>$slots<span class="token punctuation" data-v-533ddd3c>.</span>default
<span class="token keyword" data-v-533ddd3c>const</span> vnode<span class="token operator" data-v-533ddd3c>:</span> VNode <span class="token operator" data-v-533ddd3c>=</span> <span class="token function" data-v-533ddd3c>getFirstComponentChild</span><span class="token punctuation" data-v-533ddd3c>(</span>slot<span class="token punctuation" data-v-533ddd3c>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>如果 keep-alive 存在多个子元素，keep-alive 要求同时只有一个子元素被渲染。所以在开头会获取插槽内的子元素，调用 getFirstComponentChild 获取到第一个子元素的 VNode.</p> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>
  <span class="token comment" data-v-533ddd3c>// not included</span>
  <span class="token punctuation" data-v-533ddd3c>(</span>include <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token operator" data-v-533ddd3c>!</span>name <span class="token operator" data-v-533ddd3c>||</span> <span class="token operator" data-v-533ddd3c>!</span><span class="token function" data-v-533ddd3c>matches</span><span class="token punctuation" data-v-533ddd3c>(</span>include<span class="token punctuation" data-v-533ddd3c>,</span> name<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token operator" data-v-533ddd3c>||</span>
  <span class="token comment" data-v-533ddd3c>// excluded</span>
  <span class="token punctuation" data-v-533ddd3c>(</span>exclude <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> name <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> <span class="token function" data-v-533ddd3c>matches</span><span class="token punctuation" data-v-533ddd3c>(</span>exclude<span class="token punctuation" data-v-533ddd3c>,</span> name<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span>
<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token keyword" data-v-533ddd3c>return</span> vnode
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>判断当前组件【keep-alive组件内的第一个子组件】是否符合缓存条件，组件名与include不匹配或与exclude匹配都会直接退出并返回 VNode【组件实例】，不走缓存机制。</p> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c>vnode<span class="token punctuation" data-v-533ddd3c>.</span>data<span class="token punctuation" data-v-533ddd3c>.</span>keepAlive <span class="token operator" data-v-533ddd3c>=</span> <span class="token boolean" data-v-533ddd3c>true</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>如果走缓存机制的话，最后会给keep-alive组件内的第一个子组件实例的keepAlive属性值设置为true</p> <div class="custom-block tip" data-v-533ddd3c><p class="custom-block-title" data-v-533ddd3c>Tips</p> <p data-v-533ddd3c>keep-alive 它不会生成真正的DOM节点，但keep-alive 并非真的不会渲染，而是渲染的对象是包裹的子组件</p></div> <h2 id="keep-alive组件渲染过程" data-v-533ddd3c><a href="#keep-alive组件渲染过程" class="header-anchor" data-v-533ddd3c>#</a> keep-alive组件渲染过程</h2> <p data-v-533ddd3c>渲染过程最主要的两个过程就是 render 和 patch，在 render 之前还会有模板编译，render 函数就是模板编译后的产物，它负责构建 VNode 树，构建好的 VNode 会传递给 patch，patch 根据 VNode 的关系生成真实dom节点树。</p> <p data-v-533ddd3c>这张图描述了 Vue 视图渲染的流程：</p> <p data-v-533ddd3c><img src="/font-docs/assets/img/6.15792659.png" alt="render" data-v-533ddd3c></p> <h3 id="keep-alive组件初始化渲染" data-v-533ddd3c><a href="#keep-alive组件初始化渲染" class="header-anchor" data-v-533ddd3c>#</a> keep-alive组件初始化渲染</h3> <p data-v-533ddd3c>组件在 patch 过程是会执行 createComponent 来挂载组件的，A组件【缓存组件】也不例外。</p> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token comment" data-v-533ddd3c>// 源码位置：src/core/vdom/patch.js</span>
<span class="token keyword" data-v-533ddd3c>function</span> <span class="token function" data-v-533ddd3c>createComponent</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token parameter" data-v-533ddd3c>vnode<span class="token punctuation" data-v-533ddd3c>,</span> insertedVnodeQueue<span class="token punctuation" data-v-533ddd3c>,</span> parentElm<span class="token punctuation" data-v-533ddd3c>,</span> refElm</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token keyword" data-v-533ddd3c>let</span> i <span class="token operator" data-v-533ddd3c>=</span> vnode<span class="token punctuation" data-v-533ddd3c>.</span>data
  <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token function" data-v-533ddd3c>isDef</span><span class="token punctuation" data-v-533ddd3c>(</span>i<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>const</span> isReactivated <span class="token operator" data-v-533ddd3c>=</span> <span class="token function" data-v-533ddd3c>isDef</span><span class="token punctuation" data-v-533ddd3c>(</span>vnode<span class="token punctuation" data-v-533ddd3c>.</span>componentInstance<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> i<span class="token punctuation" data-v-533ddd3c>.</span>keepAlive
    <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token function" data-v-533ddd3c>isDef</span><span class="token punctuation" data-v-533ddd3c>(</span>i <span class="token operator" data-v-533ddd3c>=</span> i<span class="token punctuation" data-v-533ddd3c>.</span>hook<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token operator" data-v-533ddd3c>&amp;&amp;</span> <span class="token function" data-v-533ddd3c>isDef</span><span class="token punctuation" data-v-533ddd3c>(</span>i <span class="token operator" data-v-533ddd3c>=</span> i<span class="token punctuation" data-v-533ddd3c>.</span>init<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token function" data-v-533ddd3c>i</span><span class="token punctuation" data-v-533ddd3c>(</span>vnode<span class="token punctuation" data-v-533ddd3c>,</span> <span class="token boolean" data-v-533ddd3c>false</span> <span class="token comment" data-v-533ddd3c>/* hydrating */</span><span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token punctuation" data-v-533ddd3c>}</span>

    <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token function" data-v-533ddd3c>isDef</span><span class="token punctuation" data-v-533ddd3c>(</span>vnode<span class="token punctuation" data-v-533ddd3c>.</span>componentInstance<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token function" data-v-533ddd3c>initComponent</span><span class="token punctuation" data-v-533ddd3c>(</span>vnode<span class="token punctuation" data-v-533ddd3c>,</span> insertedVnodeQueue<span class="token punctuation" data-v-533ddd3c>)</span>
      <span class="token function" data-v-533ddd3c>insert</span><span class="token punctuation" data-v-533ddd3c>(</span>parentElm<span class="token punctuation" data-v-533ddd3c>,</span> vnode<span class="token punctuation" data-v-533ddd3c>.</span>elm<span class="token punctuation" data-v-533ddd3c>,</span> refElm<span class="token punctuation" data-v-533ddd3c>)</span>
      <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token function" data-v-533ddd3c>isTrue</span><span class="token punctuation" data-v-533ddd3c>(</span>isReactivated<span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
        <span class="token function" data-v-533ddd3c>reactivateComponent</span><span class="token punctuation" data-v-533ddd3c>(</span>vnode<span class="token punctuation" data-v-533ddd3c>,</span> insertedVnodeQueue<span class="token punctuation" data-v-533ddd3c>,</span> parentElm<span class="token punctuation" data-v-533ddd3c>,</span> refElm<span class="token punctuation" data-v-533ddd3c>)</span>
      <span class="token punctuation" data-v-533ddd3c>}</span>
      <span class="token keyword" data-v-533ddd3c>return</span> <span class="token boolean" data-v-533ddd3c>true</span>
    <span class="token punctuation" data-v-533ddd3c>}</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>12</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>13</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>14</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>15</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>16</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>17</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>18</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>19</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>isReactivated 标识组件是否重新激活。在A组件初始化渲染时，A组件还没有初始化构造完成，componentInstance 还是 undefined。而A组件的 keepAlive 是 true，因为 keep-alive 作为父级包裹组件，会先于A组件挂载，也就是 kepp-alive 会先执行 render 的过程，A组件被缓存起来，之后对插槽内第一个组件（A组件）的 keepAlive 赋值为 true。</p> <p data-v-533ddd3c><strong data-v-533ddd3c>在初始化渲染中，keep-alive 将A组件缓存起来，然后正常的渲染A组件</strong></p> <h3 id="缓存渲染" data-v-533ddd3c><a href="#缓存渲染" class="header-anchor" data-v-533ddd3c>#</a> 缓存渲染</h3> <p data-v-533ddd3c>当切换到B组件，再切换回A组件时，A组件命中缓存被重新激活
非初始化渲染时，patch 会调用 patchVnode 对比新旧节点。patchVnode 内会调用 prepatch更新节属性。 prepatch内调用 updateChildComponent来更新vnode属性。</p> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token comment" data-v-533ddd3c>// 源码位置：src/core/instance/lifecycle.js</span>
<span class="token keyword" data-v-533ddd3c>export</span> <span class="token keyword" data-v-533ddd3c>function</span> <span class="token function" data-v-533ddd3c>updateChildComponent</span> <span class="token punctuation" data-v-533ddd3c>(</span>
  <span class="token parameter" data-v-533ddd3c>vm<span class="token operator" data-v-533ddd3c>:</span> Component<span class="token punctuation" data-v-533ddd3c>,</span>
  propsData<span class="token operator" data-v-533ddd3c>:</span> <span class="token operator" data-v-533ddd3c>?</span>Object<span class="token punctuation" data-v-533ddd3c>,</span>
  listeners<span class="token operator" data-v-533ddd3c>:</span> <span class="token operator" data-v-533ddd3c>?</span>Object<span class="token punctuation" data-v-533ddd3c>,</span>
  parentVnode<span class="token operator" data-v-533ddd3c>:</span> MountedComponentVNode<span class="token punctuation" data-v-533ddd3c>,</span>
  renderChildren<span class="token operator" data-v-533ddd3c>:</span> <span class="token operator" data-v-533ddd3c>?</span>Array<span class="token operator" data-v-533ddd3c>&lt;</span>VNode<span class="token operator" data-v-533ddd3c>&gt;</span></span>
<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token comment" data-v-533ddd3c>// ...</span>
  <span class="token keyword" data-v-533ddd3c>const</span> needsForceUpdate <span class="token operator" data-v-533ddd3c>=</span> <span class="token operator" data-v-533ddd3c>!</span><span class="token operator" data-v-533ddd3c>!</span><span class="token punctuation" data-v-533ddd3c>(</span>
    renderChildren <span class="token operator" data-v-533ddd3c>||</span>               <span class="token comment" data-v-533ddd3c>// has new static slots</span>
    vm<span class="token punctuation" data-v-533ddd3c>.</span>$options<span class="token punctuation" data-v-533ddd3c>.</span>_renderChildren <span class="token operator" data-v-533ddd3c>||</span>  <span class="token comment" data-v-533ddd3c>// has old static slots</span>
    hasDynamicScopedSlot
  <span class="token punctuation" data-v-533ddd3c>)</span>
  <span class="token comment" data-v-533ddd3c>// ...</span>
  <span class="token comment" data-v-533ddd3c>// resolve slots + force update if has children</span>
  <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>needsForceUpdate<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    vm<span class="token punctuation" data-v-533ddd3c>.</span>$slots <span class="token operator" data-v-533ddd3c>=</span> <span class="token function" data-v-533ddd3c>resolveSlots</span><span class="token punctuation" data-v-533ddd3c>(</span>renderChildren<span class="token punctuation" data-v-533ddd3c>,</span> parentVnode<span class="token punctuation" data-v-533ddd3c>.</span>context<span class="token punctuation" data-v-533ddd3c>)</span>
    vm<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>$forceUpdate</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token class-name" data-v-533ddd3c>Vue</span><span class="token punctuation" data-v-533ddd3c>.</span>prototype<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function-variable function" data-v-533ddd3c>$forceUpdate</span> <span class="token operator" data-v-533ddd3c>=</span> <span class="token keyword" data-v-533ddd3c>function</span> <span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token keyword" data-v-533ddd3c>const</span> vm<span class="token operator" data-v-533ddd3c>:</span> Component <span class="token operator" data-v-533ddd3c>=</span> <span class="token keyword" data-v-533ddd3c>this</span>
  <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>vm<span class="token punctuation" data-v-533ddd3c>.</span>_watcher<span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token comment" data-v-533ddd3c>// 这里最终会执行 vm._update(vm._render)</span>
    vm<span class="token punctuation" data-v-533ddd3c>.</span>_watcher<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>update</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>12</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>13</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>14</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>15</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>16</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>17</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>18</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>19</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>20</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>21</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>22</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>23</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>24</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>25</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>26</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>27</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>28</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>从注释中可以看到 needsForceUpdate 是有插槽才会为 true，keep-alive 符合条件。首先调用 resolveSlots 更新 keep-alive 的插槽，然后调用 $forceUpdate 让 keep-alive 重新渲染，再走一遍 render。因为A组件在初始化已经缓存了，keep-alive 直接返回缓存好的A组件 VNode。VNode 准备好后，又来到了 patch 阶段中的createComponent</p> <p data-v-533ddd3c>A组件再次经历 createComponent 的过程，调用 init</p> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token keyword" data-v-533ddd3c>const</span> componentVNodeHooks <span class="token operator" data-v-533ddd3c>=</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token function" data-v-533ddd3c>init</span> <span class="token punctuation" data-v-533ddd3c>(</span>vnode<span class="token operator" data-v-533ddd3c>:</span> VNodeWithData<span class="token punctuation" data-v-533ddd3c>,</span> hydrating<span class="token operator" data-v-533ddd3c>:</span> boolean<span class="token punctuation" data-v-533ddd3c>)</span><span class="token operator" data-v-533ddd3c>:</span> <span class="token operator" data-v-533ddd3c>?</span>boolean <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>if</span> <span class="token punctuation" data-v-533ddd3c>(</span>
      vnode<span class="token punctuation" data-v-533ddd3c>.</span>componentInstance <span class="token operator" data-v-533ddd3c>&amp;&amp;</span>
      <span class="token operator" data-v-533ddd3c>!</span>vnode<span class="token punctuation" data-v-533ddd3c>.</span>componentInstance<span class="token punctuation" data-v-533ddd3c>.</span>_isDestroyed <span class="token operator" data-v-533ddd3c>&amp;&amp;</span>
      vnode<span class="token punctuation" data-v-533ddd3c>.</span>data<span class="token punctuation" data-v-533ddd3c>.</span>keepAlive
    <span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token comment" data-v-533ddd3c>// kept-alive components, treat as a patch</span>
      <span class="token keyword" data-v-533ddd3c>const</span> mountedNode<span class="token operator" data-v-533ddd3c>:</span> any <span class="token operator" data-v-533ddd3c>=</span> vnode <span class="token comment" data-v-533ddd3c>// work around flow</span>
      componentVNodeHooks<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>prepatch</span><span class="token punctuation" data-v-533ddd3c>(</span>mountedNode<span class="token punctuation" data-v-533ddd3c>,</span> mountedNode<span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token punctuation" data-v-533ddd3c>}</span> <span class="token keyword" data-v-533ddd3c>else</span> <span class="token punctuation" data-v-533ddd3c>{</span>
      <span class="token keyword" data-v-533ddd3c>const</span> child <span class="token operator" data-v-533ddd3c>=</span> vnode<span class="token punctuation" data-v-533ddd3c>.</span>componentInstance <span class="token operator" data-v-533ddd3c>=</span> <span class="token function" data-v-533ddd3c>createComponentInstanceForVnode</span><span class="token punctuation" data-v-533ddd3c>(</span>
        vnode<span class="token punctuation" data-v-533ddd3c>,</span>
        activeInstance
      <span class="token punctuation" data-v-533ddd3c>)</span>
      child<span class="token punctuation" data-v-533ddd3c>.</span><span class="token function" data-v-533ddd3c>$mount</span><span class="token punctuation" data-v-533ddd3c>(</span>hydrating <span class="token operator" data-v-533ddd3c>?</span> vnode<span class="token punctuation" data-v-533ddd3c>.</span>elm <span class="token operator" data-v-533ddd3c>:</span> <span class="token keyword" data-v-533ddd3c>undefined</span><span class="token punctuation" data-v-533ddd3c>,</span> hydrating<span class="token punctuation" data-v-533ddd3c>)</span>
    <span class="token punctuation" data-v-533ddd3c>}</span>
  <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>12</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>13</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>14</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>15</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>16</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>17</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>18</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>19</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>这时将不再走 $mount 的逻辑，只调用 prepatch 更新实例属性。所以在缓存组件被激活时，不会执行 created 和 mounted 的生命周期函数。</p> <p data-v-533ddd3c>最后调用 insert 插入组件的dom节点，至此缓存渲染流程完成</p> <p data-v-533ddd3c><strong data-v-533ddd3c>缓存渲染时，keep-alive 会更新插槽内容，之后 $forceUpdate 重新渲染</strong></p> <h2 id="面试" data-v-533ddd3c><a href="#面试" class="header-anchor" data-v-533ddd3c>#</a> 面试</h2> <p data-v-533ddd3c>问：如何实现？
假设这里有 3 个路由： A、B、C。需求：</p> <ul data-v-533ddd3c><li data-v-533ddd3c>默认显示 A</li> <li data-v-533ddd3c>B 跳到 A，A 不刷新</li> <li data-v-533ddd3c>C 跳到 A，A 刷新</li></ul> <p data-v-533ddd3c>答：
使用keep-alive + router-view结合</p> <div class="language-html line-numbers-mode" data-v-533ddd3c><pre class="language-html" data-v-533ddd3c><code data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-533ddd3c>v-if</span><span class="token attr-value" data-v-533ddd3c><span class="token punctuation attr-equals" data-v-533ddd3c>=</span><span class="token punctuation" data-v-533ddd3c>&quot;</span>$route.meta.keepAlive<span class="token punctuation" data-v-533ddd3c>&quot;</span></span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
  <span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>router-view</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span><span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>router-view</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
<span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;</span>router-view</span> <span class="token attr-name" data-v-533ddd3c>v-else</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span><span class="token tag" data-v-533ddd3c><span class="token tag" data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>&lt;/</span>router-view</span><span class="token punctuation" data-v-533ddd3c>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c></div></div><ol data-v-533ddd3c><li data-v-533ddd3c>A路由，设置meta.keepAlive属性</li></ol> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token punctuation" data-v-533ddd3c>{</span>
  path<span class="token operator" data-v-533ddd3c>:</span> <span class="token string" data-v-533ddd3c>'/'</span><span class="token punctuation" data-v-533ddd3c>,</span>
  name<span class="token operator" data-v-533ddd3c>:</span> <span class="token string" data-v-533ddd3c>'A'</span><span class="token punctuation" data-v-533ddd3c>,</span>
  component<span class="token operator" data-v-533ddd3c>:</span> <span class="token constant" data-v-533ddd3c>A</span><span class="token punctuation" data-v-533ddd3c>,</span>
  meta<span class="token operator" data-v-533ddd3c>:</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    keepAlive<span class="token operator" data-v-533ddd3c>:</span> <span class="token boolean" data-v-533ddd3c>true</span> <span class="token comment" data-v-533ddd3c>// 默认会缓存</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c></div></div><ol start="2" data-v-533ddd3c><li data-v-533ddd3c>在 B 组件里面设置 beforeRouteLeave</li></ol> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token keyword" data-v-533ddd3c>export</span> <span class="token keyword" data-v-533ddd3c>default</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token function" data-v-533ddd3c>data</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>return</span> <span class="token punctuation" data-v-533ddd3c>{</span><span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>;</span>
  <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>
  methods<span class="token operator" data-v-533ddd3c>:</span> <span class="token punctuation" data-v-533ddd3c>{</span><span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>
  <span class="token function" data-v-533ddd3c>beforeRouteLeave</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token parameter" data-v-533ddd3c>to<span class="token punctuation" data-v-533ddd3c>,</span> from<span class="token punctuation" data-v-533ddd3c>,</span> next</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token comment" data-v-533ddd3c>// 设置下一个路由的 meta</span>
    to<span class="token punctuation" data-v-533ddd3c>.</span>meta<span class="token punctuation" data-v-533ddd3c>.</span>keepAlive <span class="token operator" data-v-533ddd3c>=</span> <span class="token boolean" data-v-533ddd3c>true</span><span class="token punctuation" data-v-533ddd3c>;</span>  <span class="token comment" data-v-533ddd3c>// 让 A 缓存，即不刷新</span>
    <span class="token function" data-v-533ddd3c>next</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>;</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c></div></div><ol start="3" data-v-533ddd3c><li data-v-533ddd3c>在 C 组件里面设置 beforeRouteLeave</li></ol> <div class="language-js line-numbers-mode" data-v-533ddd3c><pre class="language-js" data-v-533ddd3c><code data-v-533ddd3c><span class="token keyword" data-v-533ddd3c>export</span> <span class="token keyword" data-v-533ddd3c>default</span> <span class="token punctuation" data-v-533ddd3c>{</span>
  <span class="token function" data-v-533ddd3c>data</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token keyword" data-v-533ddd3c>return</span> <span class="token punctuation" data-v-533ddd3c>{</span><span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>;</span>
  <span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>
  methods<span class="token operator" data-v-533ddd3c>:</span> <span class="token punctuation" data-v-533ddd3c>{</span><span class="token punctuation" data-v-533ddd3c>}</span><span class="token punctuation" data-v-533ddd3c>,</span>
  <span class="token function" data-v-533ddd3c>beforeRouteLeave</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token parameter" data-v-533ddd3c>to<span class="token punctuation" data-v-533ddd3c>,</span> from<span class="token punctuation" data-v-533ddd3c>,</span> next</span><span class="token punctuation" data-v-533ddd3c>)</span> <span class="token punctuation" data-v-533ddd3c>{</span>
    <span class="token comment" data-v-533ddd3c>// 设置下一个路由的 meta</span>
    to<span class="token punctuation" data-v-533ddd3c>.</span>meta<span class="token punctuation" data-v-533ddd3c>.</span>keepAlive <span class="token operator" data-v-533ddd3c>=</span> <span class="token boolean" data-v-533ddd3c>false</span><span class="token punctuation" data-v-533ddd3c>;</span> <span class="token comment" data-v-533ddd3c>// 让 A 不缓存，即刷新</span>
    <span class="token function" data-v-533ddd3c>next</span><span class="token punctuation" data-v-533ddd3c>(</span><span class="token punctuation" data-v-533ddd3c>)</span><span class="token punctuation" data-v-533ddd3c>;</span>
  <span class="token punctuation" data-v-533ddd3c>}</span>
<span class="token punctuation" data-v-533ddd3c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-533ddd3c><span class="line-number" data-v-533ddd3c>1</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>2</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>3</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>4</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>5</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>6</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>7</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>8</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>9</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>10</span><br data-v-533ddd3c><span class="line-number" data-v-533ddd3c>11</span><br data-v-533ddd3c></div></div><p data-v-533ddd3c>这样便能实现 B 回到 A，A 不刷新；而 C 回到 A 则刷新</p> <p data-v-533ddd3c>问：keep-alive原理，说说你的理解</p> <p data-v-533ddd3c>答：</p> <ol data-v-533ddd3c><li data-v-533ddd3c>抽象组件：keep-alive 组件通过abstract 来声明成抽象组件, 在生成组件对应父子关系时会跳过抽象组件，所以keep-alive不会生成真正的DOM节点</li> <li data-v-533ddd3c>渲染keep-alive: keep-alive组件定义了render函数。虽然keep-alive不会生成真正的DOM节点，但keep-alive 并非真的不会渲染，而是对keep-alive包裹的第一个子组件做处理(用到插槽this.$slots.default)；根据LRU策略缓存组件 VNode；render 函数返回第一个子组件的 VNode</li> <li data-v-533ddd3c>缓存渲染过程：</li></ol> <ul data-v-533ddd3c><li data-v-533ddd3c>初始化渲染：，keep-alive 将缓存组件缓存起来，然后正常的渲染组件</li> <li data-v-533ddd3c>缓存渲染时，keep-alive 会更新插槽内容，之后 $forceUpdate 重新渲染，从缓存中读取之前的组件 VNode 实现状态缓存</li></ul> <p data-v-533ddd3c><strong data-v-533ddd3c>第三步加点额外理解</strong>：$forceUpdate重新渲染，先渲染keep-alive，从this.cache缓存命中缓存组件，返回缓存组件的vnode。接着渲染缓存组件，由于vnode.componentInstance &amp;&amp; vnode.data.keepAlive为true，所以不走$mount，也就没有beforeCreate、created、mounted 钩子</p> <p data-v-533ddd3c>参考：
<a href="https://www.jianshu.com/p/0b0222954483" target="_blank" rel="noopener noreferrer" data-v-533ddd3c>vue-router 之 keep-alive<span data-v-533ddd3c><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://www.cnblogs.com/chanwahfung/p/13523396.html" target="_blank" rel="noopener noreferrer" data-v-533ddd3c>Vue源码解析，keep-alive是如何实现缓存的？<span data-v-533ddd3c><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://juejin.cn/post/6844903837770203144" target="_blank" rel="noopener noreferrer" data-v-533ddd3c>彻底揭秘keep-alive原理<span data-v-533ddd3c><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/13/2021, 11:38:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/font-docs/vue/compiler/slot.html" class="prev">
        插槽
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/font-docs/assets/js/app.ab113d22.js" defer></script><script src="/font-docs/assets/js/2.a7702232.js" defer></script><script src="/font-docs/assets/js/30.c9f6fdd6.js" defer></script>
  </body>
</html>
