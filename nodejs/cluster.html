<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>亮神前端小册</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="亮神前端小册">
    
    <link rel="preload" href="/font-docs/assets/css/0.styles.f8f07172.css" as="style"><link rel="preload" href="/font-docs/assets/js/app.ab113d22.js" as="script"><link rel="preload" href="/font-docs/assets/js/2.a7702232.js" as="script"><link rel="preload" href="/font-docs/assets/js/36.11df78b4.js" as="script"><link rel="prefetch" href="/font-docs/assets/js/10.3d24c721.js"><link rel="prefetch" href="/font-docs/assets/js/100.b317c338.js"><link rel="prefetch" href="/font-docs/assets/js/101.b20aa33e.js"><link rel="prefetch" href="/font-docs/assets/js/102.b1f8d3b3.js"><link rel="prefetch" href="/font-docs/assets/js/103.ecb92d20.js"><link rel="prefetch" href="/font-docs/assets/js/104.59d1da3b.js"><link rel="prefetch" href="/font-docs/assets/js/105.b6bb704c.js"><link rel="prefetch" href="/font-docs/assets/js/106.32bea12f.js"><link rel="prefetch" href="/font-docs/assets/js/107.2a3c779a.js"><link rel="prefetch" href="/font-docs/assets/js/108.a28ed267.js"><link rel="prefetch" href="/font-docs/assets/js/109.e83bff13.js"><link rel="prefetch" href="/font-docs/assets/js/11.5bc93b46.js"><link rel="prefetch" href="/font-docs/assets/js/110.7fc996c2.js"><link rel="prefetch" href="/font-docs/assets/js/111.de0109d7.js"><link rel="prefetch" href="/font-docs/assets/js/112.85b9449c.js"><link rel="prefetch" href="/font-docs/assets/js/113.fc975125.js"><link rel="prefetch" href="/font-docs/assets/js/114.216bea7c.js"><link rel="prefetch" href="/font-docs/assets/js/115.090cfb62.js"><link rel="prefetch" href="/font-docs/assets/js/116.afa4d357.js"><link rel="prefetch" href="/font-docs/assets/js/117.914c90da.js"><link rel="prefetch" href="/font-docs/assets/js/118.36abb410.js"><link rel="prefetch" href="/font-docs/assets/js/119.d885fe45.js"><link rel="prefetch" href="/font-docs/assets/js/12.961a36e2.js"><link rel="prefetch" href="/font-docs/assets/js/120.54ed503a.js"><link rel="prefetch" href="/font-docs/assets/js/121.c3ea5174.js"><link rel="prefetch" href="/font-docs/assets/js/122.a623dd2a.js"><link rel="prefetch" href="/font-docs/assets/js/13.4c670e5e.js"><link rel="prefetch" href="/font-docs/assets/js/14.a1ce3775.js"><link rel="prefetch" href="/font-docs/assets/js/15.fa5a860a.js"><link rel="prefetch" href="/font-docs/assets/js/16.edacc258.js"><link rel="prefetch" href="/font-docs/assets/js/17.f8df7a8b.js"><link rel="prefetch" href="/font-docs/assets/js/18.72dcdd23.js"><link rel="prefetch" href="/font-docs/assets/js/19.706d6807.js"><link rel="prefetch" href="/font-docs/assets/js/20.108ddf67.js"><link rel="prefetch" href="/font-docs/assets/js/21.7da88a2a.js"><link rel="prefetch" href="/font-docs/assets/js/22.70a646e4.js"><link rel="prefetch" href="/font-docs/assets/js/23.c1c80ab4.js"><link rel="prefetch" href="/font-docs/assets/js/24.8be1409c.js"><link rel="prefetch" href="/font-docs/assets/js/25.dafa3760.js"><link rel="prefetch" href="/font-docs/assets/js/26.694e01e9.js"><link rel="prefetch" href="/font-docs/assets/js/27.039090e0.js"><link rel="prefetch" href="/font-docs/assets/js/28.0c94be50.js"><link rel="prefetch" href="/font-docs/assets/js/29.c32e555d.js"><link rel="prefetch" href="/font-docs/assets/js/3.c0d26cb5.js"><link rel="prefetch" href="/font-docs/assets/js/30.c9f6fdd6.js"><link rel="prefetch" href="/font-docs/assets/js/31.bcbaf1a9.js"><link rel="prefetch" href="/font-docs/assets/js/32.36213dc7.js"><link rel="prefetch" href="/font-docs/assets/js/33.f7c8afde.js"><link rel="prefetch" href="/font-docs/assets/js/34.e834e023.js"><link rel="prefetch" href="/font-docs/assets/js/35.8dda312f.js"><link rel="prefetch" href="/font-docs/assets/js/37.15a9a489.js"><link rel="prefetch" href="/font-docs/assets/js/38.cec81ca8.js"><link rel="prefetch" href="/font-docs/assets/js/39.8ddef536.js"><link rel="prefetch" href="/font-docs/assets/js/4.ea27e4cd.js"><link rel="prefetch" href="/font-docs/assets/js/40.193534f1.js"><link rel="prefetch" href="/font-docs/assets/js/41.ce1b23e7.js"><link rel="prefetch" href="/font-docs/assets/js/42.11994eef.js"><link rel="prefetch" href="/font-docs/assets/js/43.1120971d.js"><link rel="prefetch" href="/font-docs/assets/js/44.e70be40e.js"><link rel="prefetch" href="/font-docs/assets/js/45.f32091eb.js"><link rel="prefetch" href="/font-docs/assets/js/46.0470b16d.js"><link rel="prefetch" href="/font-docs/assets/js/47.f8af876b.js"><link rel="prefetch" href="/font-docs/assets/js/48.ce448fc0.js"><link rel="prefetch" href="/font-docs/assets/js/49.3c9aa3b6.js"><link rel="prefetch" href="/font-docs/assets/js/5.3099e729.js"><link rel="prefetch" href="/font-docs/assets/js/50.0247cc44.js"><link rel="prefetch" href="/font-docs/assets/js/51.edaf96f4.js"><link rel="prefetch" href="/font-docs/assets/js/52.bac5c38d.js"><link rel="prefetch" href="/font-docs/assets/js/53.9a769cc8.js"><link rel="prefetch" href="/font-docs/assets/js/54.755585b1.js"><link rel="prefetch" href="/font-docs/assets/js/55.0c0d8035.js"><link rel="prefetch" href="/font-docs/assets/js/56.906e3715.js"><link rel="prefetch" href="/font-docs/assets/js/57.6d39b791.js"><link rel="prefetch" href="/font-docs/assets/js/58.e39d5548.js"><link rel="prefetch" href="/font-docs/assets/js/59.9a4436d4.js"><link rel="prefetch" href="/font-docs/assets/js/6.fa3b5319.js"><link rel="prefetch" href="/font-docs/assets/js/60.db97d3d4.js"><link rel="prefetch" href="/font-docs/assets/js/61.63ebb788.js"><link rel="prefetch" href="/font-docs/assets/js/62.2e1642b4.js"><link rel="prefetch" href="/font-docs/assets/js/63.404afa47.js"><link rel="prefetch" href="/font-docs/assets/js/64.3fc9bd1a.js"><link rel="prefetch" href="/font-docs/assets/js/65.087359aa.js"><link rel="prefetch" href="/font-docs/assets/js/66.0e1dbfa1.js"><link rel="prefetch" href="/font-docs/assets/js/67.f5508703.js"><link rel="prefetch" href="/font-docs/assets/js/68.063a4309.js"><link rel="prefetch" href="/font-docs/assets/js/69.e003c953.js"><link rel="prefetch" href="/font-docs/assets/js/7.8f66f4e3.js"><link rel="prefetch" href="/font-docs/assets/js/70.db533f79.js"><link rel="prefetch" href="/font-docs/assets/js/71.f5adc2fe.js"><link rel="prefetch" href="/font-docs/assets/js/72.c77d8ceb.js"><link rel="prefetch" href="/font-docs/assets/js/73.53bb4c8a.js"><link rel="prefetch" href="/font-docs/assets/js/74.fa982014.js"><link rel="prefetch" href="/font-docs/assets/js/75.ebc912b8.js"><link rel="prefetch" href="/font-docs/assets/js/76.360b896f.js"><link rel="prefetch" href="/font-docs/assets/js/77.09e34fb3.js"><link rel="prefetch" href="/font-docs/assets/js/78.e51a0adc.js"><link rel="prefetch" href="/font-docs/assets/js/79.0d18c5fd.js"><link rel="prefetch" href="/font-docs/assets/js/8.91fc3f7b.js"><link rel="prefetch" href="/font-docs/assets/js/80.19046804.js"><link rel="prefetch" href="/font-docs/assets/js/81.86b61c9b.js"><link rel="prefetch" href="/font-docs/assets/js/82.e3b85ba1.js"><link rel="prefetch" href="/font-docs/assets/js/83.2e228169.js"><link rel="prefetch" href="/font-docs/assets/js/84.3c6de565.js"><link rel="prefetch" href="/font-docs/assets/js/85.195aa246.js"><link rel="prefetch" href="/font-docs/assets/js/86.9592c42a.js"><link rel="prefetch" href="/font-docs/assets/js/87.4f35105c.js"><link rel="prefetch" href="/font-docs/assets/js/88.3eb20e04.js"><link rel="prefetch" href="/font-docs/assets/js/89.aa1241cf.js"><link rel="prefetch" href="/font-docs/assets/js/9.c2c6aed5.js"><link rel="prefetch" href="/font-docs/assets/js/90.097b16ac.js"><link rel="prefetch" href="/font-docs/assets/js/91.bcc1349e.js"><link rel="prefetch" href="/font-docs/assets/js/92.3b8c2727.js"><link rel="prefetch" href="/font-docs/assets/js/93.2ef6a5d8.js"><link rel="prefetch" href="/font-docs/assets/js/94.5d8072d4.js"><link rel="prefetch" href="/font-docs/assets/js/95.7e6d60ea.js"><link rel="prefetch" href="/font-docs/assets/js/96.2f7249dc.js"><link rel="prefetch" href="/font-docs/assets/js/97.bc860a09.js"><link rel="prefetch" href="/font-docs/assets/js/98.c48a9f29.js"><link rel="prefetch" href="/font-docs/assets/js/99.7f628413.js">
    <link rel="stylesheet" href="/font-docs/assets/css/0.styles.f8f07172.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/font-docs/" class="home-link router-link-active"><!----> <span class="site-name">亮神前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/font-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/font-docs/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/font-docs/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/font-docs/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/font-docs/nodejs/" class="nav-link router-link-active">
  nodejs
</a></div><div class="nav-item"><a href="/font-docs/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/font-docs/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/font-docs/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/font-docs/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/font-docs/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/font-docs/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/font-docs/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/0zcl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/font-docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/font-docs/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/font-docs/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/font-docs/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/font-docs/nodejs/" class="nav-link router-link-active">
  nodejs
</a></div><div class="nav-item"><a href="/font-docs/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/font-docs/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/font-docs/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/font-docs/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/font-docs/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/font-docs/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/font-docs/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/font-docs/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/0zcl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nodejs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/font-docs/nodejs/" aria-current="page" class="sidebar-link">glob</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/#单个星号" class="sidebar-link">单个星号</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/#问号" class="sidebar-link">问号</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/#中括号" class="sidebar-link">中括号</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/#惊叹号" class="sidebar-link">惊叹号</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/#两个星号" class="sidebar-link">两个星号</a></li></ul></li><li><a href="/font-docs/nodejs/module.html" class="sidebar-link">模块化机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#commonjs" class="sidebar-link">CommonJS</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#amd" class="sidebar-link">AMD</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#cmd" class="sidebar-link">CMD</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#umd" class="sidebar-link">UMD</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#umd的实现" class="sidebar-link">UMD的实现</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#es-modules" class="sidebar-link">ES Modules</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#export-default本质" class="sidebar-link">export default本质</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/module.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/font-docs/nodejs/eventLoop.html" class="sidebar-link">事件循环</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#事件循环" class="sidebar-link">事件循环</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#浏览器中的事件循环" class="sidebar-link">浏览器中的事件循环</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#node中的事件循环" class="sidebar-link">node中的事件循环</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#阶段概述" class="sidebar-link">阶段概述</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#timers、poll、check" class="sidebar-link">timers、poll、check</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#process-nexttick" class="sidebar-link">process.nextTick</a></li></ul></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#node-版本差异说明" class="sidebar-link">node 版本差异说明</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/eventLoop.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/font-docs/nodejs/koa.html" class="sidebar-link">KOA2框架原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/koa.html#koa2框架原理" class="sidebar-link">KOA2框架原理</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/koa.html#中间件源码" class="sidebar-link">中间件源码</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/koa.html#手写compose代码" class="sidebar-link">手写compose代码</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/koa.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/font-docs/nodejs/child_process.html" class="sidebar-link">Node子进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/child_process.html#node-js和javascript的区别" class="sidebar-link">Node.js和JavaScript的区别？</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/child_process.html#node-js-是单线程的还是多线程的" class="sidebar-link">Node.js 是单线程的还是多线程的？</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/child_process.html#cluster-是多线程吗" class="sidebar-link">cluster 是多线程吗？</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/child_process.html#node创建进程的方法和区别" class="sidebar-link">Node创建进程的方法和区别？</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/child_process.html#spawn和exec的区别" class="sidebar-link">spawn和exec的区别？</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/child_process.html#源码浅析-面试5问" class="sidebar-link">源码浅析+面试5问</a></li></ul></li><li><a href="/font-docs/nodejs/cluster.html" aria-current="page" class="active sidebar-link">cluster原理(了解)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/cluster.html#cluster原理" class="sidebar-link">cluster原理</a></li><li class="sidebar-sub-header"><a href="/font-docs/nodejs/cluster.html#node-js进程通信原理" class="sidebar-link">Node.js进程通信原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font-docs/nodejs/cluster.html#实现一个多进程架demo" class="sidebar-link">实现一个多进程架DEMO</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>在单核 CPU 系统之上我们采用 单进程 + 单线程 的模式来开发。</p> <p>在多核 CPU 系统之上，可以通过 child_process.fork 开启多个进程（Node.js 在 v0.8 版本之后新增了Cluster 来实现多进程架构） ，即 多进程 + 单线程 模式。</p> <p>注意：开启多进程不是为了解决高并发，主要是解决了单进程模式下 Node.js CPU 利用率不足的情况，充分利用多核 CPU 的性能</p> <h2 id="cluster原理"><a href="#cluster原理" class="header-anchor">#</a> cluster原理</h2> <p>集群模块可以轻松创建共享服务器端口的子进程。<a href="http://nodejs.cn/api/cluster.html" target="_blank" rel="noopener noreferrer">cluster<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> numCpus <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
<span class="token keyword">const</span> cluster <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cluster'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>cluster<span class="token punctuation">.</span>isMaster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Master process id is: '</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>
  <span class="token comment">// fork workers</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numCpus<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cluster<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  cluster<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">worker<span class="token punctuation">,</span> code<span class="token punctuation">,</span> signal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">worker </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>worker<span class="token punctuation">.</span>process<span class="token punctuation">.</span>pid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> died</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello world\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Worker </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>pid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> started</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="data:image/png;base64,UklGRrAXAABXRUJQVlA4IKQXAACwegCdASr1AQUBPm00lkikIqIhInWakIANiWdu/Eb39cq+bavlOOM/85Jjjtl3R48/v9Gn+e3ZHPpemb/q76h0WHrJ/8bf/+lv6qf3jwffs3+L/If+gdkr3a9hfj0+68Y9pv8s+zf4z+1/jD87/3//WeCfya/ovUC/KP5d/lfST+R7K/Yf9X/tfUC9bvnf+U/vX7y/3H5JPgP87+TPuR9k/8L7gH84/qP+V+4j5//0X+j8Sn7r/1PYC/iX9A/0X93/eH+yfTB/Kf+P/If6j9l/aJ+cf4L/tf5L4Bf5f/Xf+N/cv8v70v/u9rX7h//b3Sf2V/+RCT5gERIgRI93Jhu2gZ/NaqQJmtrG3BjmAREie/MAiJE9+VogIu+XJWam9u+77ep8h+d6quOpgIiRPfmAIrT4YE8jYS2G16rivXXq1qYCIkT35gERInvrlu8z65m4svqivs2YL9BBZxcz3hPfmAREie/MAiJE+Bopjn0U//J81nmjtD46/9RMdXoTBXAf36ZJ2VrIBESJ78wCIkT35flR5Vpv0eXIYJHcVkFZYjzMklbh7OWz4zFF2OpgIiRPfmAREcov//o8Z4Uf7Q2VO/b4c3CtXA/cuu6/7yybOnZljl3qq46mAiJD2T38G7+NNCI4AQ65LPuDV79GmwiLduEPcG5oUtHgRPfmAREYs4KF5c93Pawnqa8TLsjOFak+P9AWKVX23gLvU+Z6Kiq46kUFoecP+ij6ndi5rrq58X6JFDzFjZQ+Dkwtl6y+7EjI9UTlmDAEAH65KnKeDr5YQ6YHsqPjO8Ob9GB9M/mjI5KJExukqsOdmKZFHNmFBEWCZFx5wov6w+zeg4LV4BhFOxG7wfGCeI/bll5JwNEg/Kv1i4RjTzQxCl/w82DATNXZIrpmvAz4PL7jIBpb77DHDSlXi0GS9xIEU6AFrAWg/wL5+ubmxgUqbJYoK5ZeScDRIPyr9YuEY080MQpf78TQIGV7vZdGFx/8bmFRDUZuRW0u+8Pu0daBCWtWWfk3WJDkB0Qg29Z8c+LivZ9zQsoRSFY79/8aKXehVPCLfSPkV7EnoRb20Ko+4O5v5Xu0hmCf229uQuAOeqrjqYCIkXWJFVx1MBESJ78wCIR/pggXDpbr5PdmwUkOfug7IS0UeGLOyBvsVAhtxUFBwzaJo49d3eGO5VvENA+5NXs0pCsqsUbOMiUZqha0EWSTCJzkG/vi2rxyyw1eTta/tnpfpUALCOB5+781DCA0wCIkT35fT2tQUWeVTkfoMBqYhNLd8zw3Ot+t8GrsvpmUHoLW75zdAEUqaaIUY+gjdku9UAAA/vS0Dvx8ReW4yMt6sd0zlkG626FW2gmAZB2Gzz8I4afo0esxfYkACfu2pIeyJUixwvQ3IVbWcfTkch+Mtdm6RTF1Zmldy2kwRU+vNMi1dlsVkARHgwmZMAALE0W4rEj5nvKPRt9TxnUAOWMAGdmZtnkkzHrCYIka8TCfbu+GuN1akpwiJE6J7YKURilrBMX5UcgZxaEwtmD38vJbHODJXfTlrq+gBtznLymb+KuoftR7a905VjQ3ADWd31dxkv0FNTQHU/hGadKU33NTe5arjJRr+mgCrz6j4sX/rEcxP4a0F8CFjGYkdzvTMyzuPrbr8+1WefJN5Pk86AACPei/agOwQhixykIaTcSjO3AGIG/tYjf0hPu+UvB6eMH+wq1TiPFakDhdPspsyPb8w29HmSwsOu+ZgVWgXl+04SWQMabzZ/8w5l7SVwyIAFAVjsyTqUvFhYOiwsBf3BXbdoDsAYdh6p8ZX2zMiBy4zHU8nhcZ1p7J2tZg6kJmIahOMkLwbMp1jryJArVx7id4xRg5mp0fp4p0V+xhXwR+JfqGIFwDG0ccjcHxDLZvk+79XwpqkHDTEH9OosfLitKr1rbaJd3vTAAAOTTQXMyC0RvdY/zrPNflsRKTcFsRNFYyhxrmqEpqiwAhCgc+qBW2so/VWN1B5bVcU3WHbQigh36eoBM7Dt3/hEwQfKHxEHUfXAXjAKyLo0Dfj5O00x189BwdEVifxGqFaCCPnb5LaKgd+WTFVWNN5T+OBC0YaqnQbFzh9mA+J3jkayzx0d4q7wyEzYk3gXDJNlCW1rt+l70jQAIoZzKdugK+ffcmWiPLhs3/PeiMQuLAEeQoUePz6nJPYKJbiY/2+KNZgkFrYtdLdCcrOFYRAnxnkhWTXJTtsLwKfAABaODh+fvA1G01U2vEK38GeZv+U2AeQR9Q+nYVIiqb/vFhzeJc1/A/FqJ0X0vNANKGQd9d5rhwjrpffs/zq2qtE5t6/lNwZIaMWbq1BvmRUJjF/X10iwYCqoXp7c7kNE+NtD9PiBq/Ji0T03INTcP/5m3zok6M4QuCkZ/DYcrtUg+akiJs3r4JF5gRS4jc2IkdUYVgoJei9rvqlRzmZm8HmktfJnLyq0DqS9E7NbV7gWSQ2frP8mwzBJ+K8oZceVWHQwps9N7P9scXY6wlSag/FOcZYYkPdYtrs65VTIdcnizPuQaKrltkcDu2v/AV9QvwP6F9eKgwcBXYvAANnAmVoQfBVXaZUmW6VLNwscv9Vrj5rhH/gOg36v11yAU/NzALeHzxV6pLYnSQIuAAitdpeY715cE38vvbqZvU94paOHLO7kqs0uCEYCXx0RdOU9oBhn5GpAwCJrzElFgBdNuDzwMNvvZ7l6OxuzwwkAp19tUAihwdVGbeDmnskXlTbMyYSUmz6Etd27USucBzX1s/kD+SGGfCekpOBN5or+18H6KDcA7S74jOombvIQ7XAQWXIq3qY9l2TqinDZe2G0GJPxQY9d0A4iBfZ0X+0S3I1JFa2jZKsZWdH9I+WlghlJ1vif92ItVTXGHhwJyrAeoVUvuAagAM/68wxne0vmUEdtcjIxFrSHJ7i7X4ErYiwsKrpvqye3ovm1hTQPhK6qknP5pFACXRtSPCucsjd/L4mAZ1j4kKnwUsYVi4HFUQ8CHVOxzkpyouxs+NEbUBwhVO6T3ZFX3M1wP/8p3ZgpVorxsBO+ag+1W49ifmzTknJ3hUzdoU8AMgYHCKufTfYoapG+Va4Mx/tudCK7Ngvf8kf4MKm3fbb637y+pjdK8LRBcHbMz/42aHMo3BgE7vinSSeTM24ZTWtxwF9Len+jK4xddLCHcnb6u99Rt7NKR6nDCmohnv+t9lRIYtu/+HlYQBNCVnzBziRDj3E46UFHMlCUC0Jt5I822prvoRiQN4CsY6MZmMEKIxVCrlzkN5S5Ubeka2tqc2amy+9y4bq0iqfwdL9SnLLsZRs6CA+TA6zSDMo7jDWE5K9Pq7yeBz3u8nJ9om+EUALsBr2YHFMz3m9bx2OWbo7AiJJB5X5FsGAX7sR8VM3A7rcqSfypj02KlU1O3eQ8ym7VyYUxxDWt9L6j8dJaLoUGgx/aVfP0l7vJGJfj7gAogNe4aWLFVQm2W1qc995nV3m9o71py7AF8imYaOB2qQ9i80kb7bJO35pm5CV+uyepvF/1NgcpW9fBjDJRhjmYDiufe3qe7FygUwQ/enZ+1+e2umXyiarBtCNphhFr3mn/9c68hQSciCpK8uuE2ZddJdnW7djwCXMEbinksYcJHMTdzws7qlrD5yGHZBZUo9Cm4kkXMLRSzwHM6F0GK0P4ymSbac13Wbr+Ule8VIaOA0qHb+yltpMSK00tJMMwwP0Mu/RLehPHkBLx3o9jUGxQbjmrze751o4DmW7uBmr6YpPNJa6SOweZnBQEkbNZj+BztGlpBZTtqtHDQClpP1He9TbBIVd85IS0voow8ik6wCRB4XyjpKmJKzVFz/84ZINJbo53PsIgT44JfRTq7682DobguMUYUJmXZl+Po9SpL7s0Dt7s/gc62wmERd9qC7bK7LudN6JmQKUUuXH9INcfXxO+VO+mQsN6NF5knJ2cFoL0q6YB4Ux4IKlK/rW2OdEWNpC79nEAAvjeBgaeyssxP3xOy3Ues+fD2kw8oHXSSL86pYKPuzkPQ441DoyEPYPLGtZQ2o/cAdBr7zmByac0A72EbE1EPOl0nLCgLfzUhdShgAzz4meuruG743tD/cdthbuHBCobuiuUMRnkbOa5fgmq38mj1fmsTAMJ4oqjlrw14TPRXhlDVyMrsSJCmCjO9oofF71sGO7YTPuiecuyEimry5QGwkNvwNiKBFgKH8Uf7DIimqGb2nHmpJxu1oXHEpfLy+0WlM45EwnSJjb6Nx1n//Ri3KtuI+OkocweOeDTIL6db7irme9dACN7p+ToLh+eAQb38fpUaiIJtWZvbZ+DacjjMRDo1fAVHdp8P3ThnaAMpVf2kDgsNzHMXNIU6VyBuMGKfNeGQiC7p6ms7OiGYTz5+OSbGeTqbR9IvuZdsJlOcNv/YYkkEjxWJS8TF+R27Ro+IvZeFORxu/RE5LXc+/DIm0JUk+4EttaP7xOaFEXQz9eI6OBPvnCL6oSo3x8Vy/nmu6SISyfCYj3+wqHm92bWfFZkX8AmX09i3w5gyQRNsGMeusNDrgu6DofAbFKkQTQpriwfMU4Jl4QXgPYuLS6WlW1S0Bk/pB/CgMc7LhuWakTXVGSLwK/6a6YB4ZYOgL3/LMe6mvzhE1zKqKnKxSnmoq4JEgXjjUToM/W2RCNil/GUNOSiIzHnjDYCBIZW7cMzQGB4YVIYH0cIYECaNaRH+Y13r/tYuMEgCc/vQ26sBTfFpQRZ40pVf2kDgsM6OkcJ3nzNhxPJSpGadrpCLZkNz9pRSQ/MXaMNNNKYJNtY5pwullyHTRE5rbml/6RmCKn+qDM37f50aroYQ5h8zkp+h7rSADduOSPQR8GjRKY7BS1LKCzHYqtfGTn9rRUjLt10go5Homcyokcww2HtERKcTed1pWcYM/R5TVAuIv/iemX/hg4GocuGAO/9YjmjGGhn46myFqt9cNIzXxvd/NXvV5EwvHiEGvlAPBjc2pqsZgb+YX4E/hQqMOBTa/SZ8/F2E3S7+SekIg0VIivlegSQKbJzFmMmvdtwmcfLby/hRHHRYrJRVAfZ4gLLRSK7KOiq0qLDv1yYPFe1cNLiD8mmXMcuaF7d3PVIvtRJ91rZY5Xbq/hEV5w85ZEZ99SZe+s35S8D3a/1eU+HSAFFhdiwOeCX/dLlt5bcSO4t0PKl58DvEqXhobcV8ooI/Cd+jMux4yWepQWJv7aLdLom8+kfsOYI66JFwlCl3DFuVTGWaQtEiwH5xi0XzUFl1VJdo9UH9S17Q/HX8FQzdMqg+uhA1AM6rYbqvT88fZP78g8kueoAdcC2swGAd1envOCL8QppWtkiOv0u0WtTby0xLXZjyEGYqtJ0V+xsPZzfrcDQX/8TLqLcOGg4T7wqDA+XcfmxX22bokl/H3Tkei3eDSyWV9yFyb3bKd6fdGkaSQElOtds7A8iXb9+aPnn/BEejm8f1nq6U+oFfR/DWHerUASpbUwsz9fzwCDe/j9KjURBNqzN7bPwbTkcZiIdGr4Co7tPh+6cM7QBlKr+0gcFhuY5i5pCnSuQNxgxT5rwyEQXdPU1nZ0QzCefPxyTYzydTaPpF9zLthMpzht/7DEkgkeKxKXiYvyO3aNHxF7LwpyON36InJa7n34ZE2hKkn3AltrR/eJzQoi6GfrxHRwJ984RfVCVG+PiuX8813SRCWT4TEe/2FQ83uzaz4rMi/gEy+nsW+HMGSCJtgxj11hodcF3QdD4DYpUiCaFNcWD5inBMvCC8B7FxaXS0q2qWgMn9IP4UBjnZcNyzUia6oyReBX/TXTAPDLB0Be/5Zj3U1+cImuZVRU5WKU81FXBIkC8caidBn62yIRsUv4yhpyURGYkWg8SshbTHLeosTi9r7T5nz+DO33hX5FbUUJSHjrDCpMl8Mh/aA54pSBR/BW12ehjx5PkPU1BM+pwiGdvlDZ63TZ8SJzZMFJ9PB4Zrp1ycSMIhnb5Q2etwUoKHUun7etUgxlwrKfDZwCgii/SjvUFMV4gi9c0g8oyPtZ1ZeMj/NKQvFINcE1ocNQa0Jckq0SYhovzv/XfZFVH39ZhHdD0MwO7t8us0hqAsaocwJcgkwQ/O02KrOl1Hj1WXs2BbJtyGR3sGHUH/LpiyKtemdYkvQXow51Js5d0TEfAwn4dQJl00QaG8DsW4UJT5Kv9f4Va9M6xJegX9w/xK3bkA9aahX8y8OMGvXfZFVH39acEQQgRkJGaAAABHavJ651p6SRSC1kmfvdrD+Ge/wsACTUrOkT0EVDVTIf39x1YFIprofV0OcoJelwMbVCB3/jMwt76DQkcCgWd49+fooIWc6xsJ+XX/4fJtKDle9MPM1YWpFw1Hn0+OI7GNJuupIuXz1pK0QA1r+QH4EGzaZu3rrXH9sKz1L+sKE9p59n2fAu1m3dkA++RbWchA+N4NL8+95RgpU2uucpSBbcYRmIKUmTFxdlHgJ8N9Fa6U1wJn+G4THPv9LvkWuyCLFzcnbXyPaPpKRAEwFk5yWbvOoMbTWcWD6DEIBoneu6QyePcXBbJ1nQZ82EXfjm1eczS7bgNzSsz2AsVuJnQ/eD5wm/FTRR1UTwVQoAvFPfcGhRPzW4QMtCEFTheErvqoHA4z6Xt1jOm/gH6vNxjuFcdrIu5/j2z300mq1T1Y0b0Pim9JLuaWP1JgpHiRh/I9BPCnth5rD29rTF9mWWLyG/YzmbABvheut7+j2Ucq9rcmW+ZRsd2EEAk0qGe8aqgt3gw9GdKv46Tgdu4hWbqtPMtB6kLws0USzwrvTrxzd44siTdoSq/JxlGhL59xOqpB7JbIEFATizaf81Z+e5ixEUiBu+P0V36ZervfumTj63my8ZryTuTSM2T8UuATRvI3y8qRnF6Rz2WnsBxJTLBpCdyPb3EfS3WWVY3e3xt/1NvhhY5+9lLACIWN2T7bUd91CqxbMp0yclxW143HfP6/MZ9pS3V9WN43O/YGcnO4xHWNFtSghe5lUTH362p/czrsPuwXSpCNeKBpymQU1Hs8RaCWUvnz/HToy6Yf8PePdxVqHD49ClzC2rslhoanupkYvoZ0vYaND/e+0Vi9Q/9VBF6l/lOHzltv86JuWv1WsH/GkSDF4foSfeTl5B/pKPlk96u1sYRnNEwGNlxBaBa1YLtWbgg8FzSrRdVZ91vKFf0BXCQZfiaOo3B34HVf22FhOQxrIwT5mNP47rtdkJz0TyLPJqKcxrM3l91u03N5XEHyonWlabgipKxlH8AlU8p1HekpKvwYfpdTRqJ+bAS7mQY2W8/4dljkzLQ8nY0G1wzUtAPy+WsnUtK5HXiSCHrrzdytWpqPrJiMNhfdqpUn6qlZMqQAvE9+hVxzXQOaJrv2BVpipp4nNUNDNmBdZxRfPwbITl5/D41+vFij3sLQHWWYEoKAJ2qDCKgcQk+U9NjeibGtcX4hyd1dnd6VUnWLe640ekCCaVhpOpH5FSHdftQ/8L/8JJxMKO7JdQ8iM2NkUKU6YOJTcGplOGoqapRKyzWg5KTRCehSwPopMEvXQGf3CT5ESvgxtExQerqYF3c1ZHjExIJvN3tV6VG8A/X75/1zdhNC8A6PpIn+gMbVFSIfWaBXX8y3RWLRs1a1w5LteARA7U2l0lW7i/q4tXHcpviysYfIOcQnBHbtorsUp9mnRR/de9GW7zJf0tWnJL1yCnnO0ynR0YHhDwW7krKwKxR1KjK8LMZ3LTEL9h9t6WoqK3wp5wGY0J2O/3PH+rzwylgUigCEyZ3eJMgOXZ2IvNd8hj1E8+9/g36bnXiW1h50npq+B/XE+Gxkyr/iS9VeJseuZKCHcOWY7HkUaJa6Jofx/cKi50aAV7bt0CuVl/qxjtey9Fuj+DXRREzrsPuwXSpHb32a8f+dE3MrJGee7fSDQKzMoZnivp9xWB/op04v3bcVUquKN2BpKCpbrtqXI4GCumbfS8W/OF337bOoAEtwAXnSUs44fm3F7PdLT0pAc6clttEa+YGi42lAD4WVMdNBmo+GQomu6kIPQiolLLch3UcoZTI9PPIsN0uXACEe7ct2usgRYBno+HUeJcoiMHTVOrYZ2P6HlwcfgAAAA" alt="cluster"></p> <p>cluster模块调用fork方法来创建子进程，该方法与child_process中的fork是同一个方法。cluster模块采用的是经典的主从模型，Cluster会创建一个master，然后根据你指定的数量复制出多个子进程，可以使用 <code>cluster.isMaster</code>属性判断当前进程是master还是worker(工作进程)。</p> <p>由master进程来管理所有的子进程，主进程不负责具体的任务处理，主要工作是负责调度和管理。</p> <p>如果多个Node进程监听同一个端口时会出现 Error:listen EADDRIUNS的错误，而cluster模块为什么可以让多个子进程监听同一个端口呢?</p> <p>原因是master进程内部启动了一个<code>TCP服务器</code>，而真正监听端口的只有这个服务器，当来自前端的请求触发服务器的connection事件后，<code>master会将对应的socket具柄发送给子进程</code>。</p> <h2 id="node-js进程通信原理"><a href="#node-js进程通信原理" class="header-anchor">#</a> Node.js进程通信原理</h2> <p>IPC: inter-process communication. <a href="https://juejin.cn/post/6844903911556382728" target="_blank" rel="noopener noreferrer">进程间通信<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>有哪些？</p> <ol><li>管道（父子进程、兄弟进程之间）: 创建子进程时，默认使用管道<a href="http://nodejs.cn/api/child_process.html#optionsstdio" target="_blank" rel="noopener noreferrer">pip<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>信号量</li> <li>共享内存</li> <li>消息队列</li></ol> <p>IPC通信管道是如何创建的？</p> <p><img src="/font-docs/assets/img/9.652d81f1.png" alt="pip"></p> <p>父进程在创建子进程前，会创建IPC管道并监听它，然后再创建出子进程，同时会通过环境变量（NODE_CHANNEL_FD）告诉子进程这个IPC通道的文件描述符。子进程启动时，根据文件描述符去连接IPC管道。从而完成父子进程之间的连接</p> <p>send句柄发送的时候，真的是将服务器对象发送给了子进程？</p> <p><img src="/font-docs/assets/img/10.1d6af34b.png" alt="pip"></p> <p>发送到IPC管道中的实际上是我们要发送的<code>句柄文件描述符</code>, JSON.stringfy()序列化再发送到IPC管道，子进程JSON.parse()解析还原为对象。个人理解：主进程发送句柄到管道，子进程接收句柄并创建对应的服务。虽然看起来像是主进程的服务在处理的，但实际上是通过句柄，子进程创建的服务在处理的。</p> <h3 id="实现一个多进程架demo"><a href="#实现一个多进程架demo" class="header-anchor">#</a> 实现一个多进程架DEMO</h3> <p>master.js</p> <details class="custom-block details"><summary>DETAILS</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// master.js</span>
<span class="token keyword">const</span> fork <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fork<span class="token punctuation">;</span>
<span class="token keyword">const</span> cpus <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'node-master'</span>

<span class="token keyword">const</span> workers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">createWorker</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">)</span>
    worker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>act <span class="token operator">===</span> <span class="token string">'suicide'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">createWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    worker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> signal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'worker process exited, code: %s signal: %s'</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> signal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> workers<span class="token punctuation">[</span>worker<span class="token punctuation">.</span>pid<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    worker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'server'</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    workers<span class="token punctuation">[</span>worker<span class="token punctuation">.</span>pid<span class="token punctuation">]</span> <span class="token operator">=</span> worker<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'worker process created, pid: %s ppid: %s'</span><span class="token punctuation">,</span> worker<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> process<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>cpus<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">createWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

process<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'SIGINT'</span><span class="token punctuation">,</span> <span class="token function">close</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'SIGINT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// kill(2) Ctrl-C</span>
process<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'SIGQUIT'</span><span class="token punctuation">,</span> <span class="token function">close</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'SIGQUIT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// kill(3) Ctrl-\</span>
process<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">,</span> <span class="token function">close</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'SIGTERM'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// kill(15) default</span>
process<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token function">close</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">close</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进程退出！'</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> pid <span class="token keyword">in</span> workers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'master process exited, kill worker pid: '</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            workers<span class="token punctuation">[</span>pid<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">'SIGINT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div></details> <p>worker.js</p> <details class="custom-block details"><summary>DETAILS</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// worker.js</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plan'</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'I am worker, pid: '</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>pid <span class="token operator">+</span> <span class="token string">', ppid: '</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>ppid<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'worker process exception!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 测试异常进程退出、重启</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> worker<span class="token punctuation">;</span>
process<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'node-worker'</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> sendHandle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">===</span> <span class="token string">'server'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		worker <span class="token operator">=</span> sendHandle<span class="token punctuation">;</span>
		worker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			server<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
	process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>act<span class="token operator">:</span> <span class="token string">'suicide'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	worker<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></details> <p><a href="https://mp.weixin.qq.com/s/VzXnnfn4gCBMd5wea3LRIg" target="_blank" rel="noopener noreferrer">深入理解 Node.js 进程与线程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/25/2021, 4:54:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/font-docs/nodejs/child_process.html" class="prev">
        Node子进程
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/font-docs/assets/js/app.ab113d22.js" defer></script><script src="/font-docs/assets/js/2.a7702232.js" defer></script><script src="/font-docs/assets/js/36.11df78b4.js" defer></script>
  </body>
</html>
